<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ginza - Girls</title>
<link rel="stylesheet" href="https://sydneyginza.github.io/styles.css">
</head>
<body>
<div class="loading-screen" id="loadingScreen"><div class="loading-spinner"></div><div class="loading-text">Loading Data</div></div>
<div class="toast" id="toast"></div>
<div class="particles" id="particles"></div>
<nav>
<div class="logo">GINZA</div>
<div class="nav-right">
<div class="nav-links">
<a href="#" id="navHome" class="active">Home</a>
<a href="#" id="navRoster">Roster</a>
<a href="#" id="navGirls">Girls</a>
<a href="#" id="navCalendar" style="display:none">Calendar</a>
</div>
<div style="position:relative">
<button class="login-icon-btn" id="loginIconBtn"><svg viewBox="0 0 24 24"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg></button>
<div class="user-dropdown" id="userDropdown"></div>
</div></div></nav>

<div class="page active" id="homePage"><section class="home-section">
<div class="home-title">GINZA</div>
<div class="home-tagline">Sydney's Premier Experience</div>
<div class="home-images" id="homeImages"></div>
<div class="home-mid">
<div class="home-mid-left">
<div class="home-divider-sm"></div>
<div class="logo" style="margin-bottom:20px">Announcement</div>
<div class="home-summary">Discover our exclusive selection of stunning girls. Each profile is carefully curated to ensure the highest quality experience. Browse our roster to find your perfect match.</div>
<div class="home-announce" id="homeAnnounce"></div>
</div>
<div class="home-mid-right">
<div class="logo" style="margin-bottom:20px">New Girls</div>
<div class="home-newgirls" id="homeNewGirls">
<div class="ng-nav" id="ngNav"></div>
<div class="ng-display" id="ngDisplay"></div>
</div>
</div>
</div>
<div class="home-divider"></div>
<div class="logo" style="margin-bottom:20px">Welcome</div>
<div class="home-summary">Discover our exclusive selection of stunning companions. Each profile is carefully curated to ensure the highest quality experience. Browse our roster to find your perfect match.</div>
<div class="logo" style="margin-bottom:20px">Location</div>
<div class="home-summary">310 Cleveland St Surry Hills NSW 2010
<div class="home-summary">(back entrance from goodlet lane)</div>
<div class="logo" style="margin-bottom:20px">Hours</div>
<div class="home-summary">Monday to Sunday open from 10:30am till 1am.</div>

</section></div>

<div class="page" id="rosterPage"><section class="section">
<div class="section-header"><div class="section-line"></div><div><div class="section-tag">Ginza</div><div class="section-title">Roster</div></div></div>
<div class="filter-bar" id="rosterFilterBar"></div>
<div class="girls-grid" id="rosterGrid"></div>
</section></div>

<div class="page" id="listPage"><section class="section">
<div class="section-header"><div class="section-line"></div><div><div class="section-tag">Ginza</div><div class="section-title">Girls</div></div></div>
<div class="filter-bar" id="filterBar"></div>
<div class="girls-grid" id="girlsGrid"></div>
</section></div>

<div class="page" id="calendarPage"><section class="section">
<div class="section-header"><div class="section-line"></div><div><div class="section-tag">Admin</div><div class="section-title">Calendar</div></div></div>
<div class="filter-bar" id="calFilterBar"></div>
<div style="overflow-x:auto"><table class="cal-table" id="calTable"></table></div>
</section></div>

<div class="page" id="profilePage">
<div class="profile-nav-rail" id="profileNavRail"></div>
<div class="profile-page" id="profileContent"></div>
</div>

<div class="lightbox-overlay" id="lightbox">
<button class="lightbox-close" id="lbClose">&times;</button>
<button class="lightbox-nav lightbox-prev" id="lbPrev"><svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></button>
<img id="lbImg" src="">
<button class="lightbox-nav lightbox-next" id="lbNext"><svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></button>
</div>

<div class="modal-overlay" id="formOverlay"><div class="form-modal">
<button class="modal-close" id="formClose">&times;</button>
<div class="form-title" id="formTitle">Add New Girl</div>
<input type="hidden" id="editIndex" value="-1">
<div class="form-row"><div class="form-group"><label class="form-label">Name</label><input class="form-input" id="fName" placeholder="Name..."></div>
<div class="form-group"><label class="form-label">Location</label><select class="form-input" id="fLocation"><option value="">Select location</option><option value="Club">Club</option><option value="Empire">Empire</option></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Country</label><select class="form-input" id="fCountry"><option value="">Select country</option><option value="Chinese">Chinese</option><option value="Japanese">Japanese</option><option value="Korean">Korean</option><option value="Other">Other</option></select></div>
<div class="form-group"><label class="form-label">Age</label><input class="form-input" id="fAge" type="number" min="0" placeholder="e.g. 23"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Body Size</label><input class="form-input" id="fBody" type="number" min="0" placeholder="e.g. 6"></div>
<div class="form-group"><label class="form-label">Height (cm)</label><input class="form-input" id="fHeight" type="number" min="0" placeholder="e.g. 162"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Cup Size</label><input class="form-input" id="fCup" placeholder="e.g. B-C"></div>
<div class="form-group"><label class="form-label">Experience</label><select class="form-input" id="fExp"><option value="">Select experience</option><option value="Experienced">Experienced</option><option value="Inexperienced">Inexperienced</option></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Value 1</label><div style="position:relative"><span style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--accent);font-size:15px;pointer-events:none">$</span><input class="form-input" id="fVal1" type="number" min="0" style="padding-left:26px" placeholder="e.g. 100"></div></div>
<div class="form-group"><label class="form-label">Value 2</label><div style="position:relative"><span style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--accent);font-size:15px;pointer-events:none">$</span><input class="form-input" id="fVal2" type="number" min="0" style="padding-left:26px" placeholder="e.g. 200"></div></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Value 3</label><div style="position:relative"><span style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--accent);font-size:15px;pointer-events:none">$</span><input class="form-input" id="fVal3" type="number" min="0" style="padding-left:26px" placeholder="e.g. 300"></div></div>
<div class="form-group"><label class="form-label">Start Date</label><input class="form-input" id="fStartDate" type="date"></div></div>
<div class="form-row full"><div class="form-group"><label class="form-label">Photos <span style="color:var(--text-dim);font-weight:400" id="fPhotoCount">(0 / 10)</span></label>
<div id="fPhotoGrid" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px"></div></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Language</label><input class="form-input" id="fLang" placeholder="e.g. Japanese, English"></div>
<div class="form-group"><label class="form-label">Type</label><input class="form-input" id="fType" placeholder="e.g. Very young, small, cute, innocent..."></div></div>
<div class="form-row full"><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="fDesc" placeholder="Description..."></textarea></div></div>
<div class="form-actions"><button class="btn btn-secondary" id="formCancel">Cancel</button><button class="btn btn-primary" id="formSave">Save</button></div>
</div></div>

<div class="modal-overlay" id="deleteOverlay"><div class="form-modal" style="max-width:420px;text-align:center">
<div class="form-title" style="margin-bottom:12px">Confirm Delete</div>
<p style="color:var(--text-dim);margin-bottom:28px;font-size:15px" id="deleteMsg">Are you sure?</p>
<div class="form-actions" style="justify-content:center"><button class="btn btn-secondary" id="deleteCancel">Cancel</button><button class="btn btn-danger" id="deleteConfirm">Delete</button></div>
</div></div>

<div class="copy-time-modal" id="copyTimeModal">
<div class="copy-time-box">
<div class="copy-time-title">Copy Times?</div>
<div class="copy-time-msg" id="copyTimeMsg"></div>
<div class="copy-time-detail" id="copyTimeDetail"></div>
<div class="copy-time-actions">
<button class="btn btn-danger" id="copyTimeCancel">Cancel</button>
<button class="btn btn-secondary" id="copyTimeNew">Set New Time</button>
<button class="btn btn-primary" id="copyTimeCopy">Copy Times</button>
</div>
</div>
</div>

<footer><p>Ginza &copy; 2026 &mdash; All Rights Reserved</p></footer>

<script>
let CRED=[];
const BT='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';
const BR='sydneyginza/files',BA=`https://api.github.com/repos/${BR}/contents`,CP='data/config.json';
let GT='',GR='',GRD='',GA='',GAD='';
const DP='data/girls.json',AP='data/auth.json',KP='data/calendar.json';
let loggedIn=false,dataSha=null,calSha=null,calData={},loggedInUser=null,MAX_PHOTOS=10,profileReturnPage='homePage';

function showToast(m,t='success'){const e=document.getElementById('toast');e.textContent=m;e.className='toast '+t+' show';clearTimeout(e._t);e._t=setTimeout(()=>e.classList.remove('show'),3000)}
function getAEDTDate(){return new Date(new Date().toLocaleString('en-US',{timeZone:'Australia/Sydney'}))}
function fmtDate(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
function getWeekDates(){const t=getAEDTDate(),a=[];for(let i=0;i<7;i++){const d=new Date(t);d.setDate(t.getDate()+i);a.push(fmtDate(d))}return a}
function dispDate(ds){const d=new Date(ds+'T00:00:00');return{date:d.getDate()+' '+['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][d.getMonth()],day:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()]}}
function dec(c){return JSON.parse(decodeURIComponent(escape(atob(c.replace(/\n/g,'')))))}
function enc(o){return btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))))}
function ghH(t){return{'Authorization':`token ${t}`,'Accept':'application/vnd.github.v3+json'}}

async function loadConfig(){
try{const r=await fetch(`${BA}/${CP}`,{headers:ghH(BT)});
if(r.ok){const cfg=dec((await r.json()).content);GT=cfg.token||BT;GR=cfg.site_repo||'sydneyginza/sydneyginza.github.io';GRD=cfg.data_repo||BR;GA=`https://api.github.com/repos/${GR}/contents`;GAD=`https://api.github.com/repos/${GRD}/contents`;return true}
if(r.status===404){const def={token:BT,site_repo:'sydneyginza/sydneyginza.github.io',data_repo:BR};await fetch(`${BA}/${CP}`,{method:'PUT',headers:{'Authorization':`token ${BT}`,'Content-Type':'application/json'},body:JSON.stringify({message:'Create config',content:enc(def)})});GT=def.token;GR=def.site_repo;GRD=def.data_repo;GA=`https://api.github.com/repos/${GR}/contents`;GAD=`https://api.github.com/repos/${GRD}/contents`;return true}
}catch(e){console.error(e)}GT=BT;GR='sydneyginza/sydneyginza.github.io';GRD=BR;GA=`https://api.github.com/repos/${GR}/contents`;GAD=`https://api.github.com/repos/${GRD}/contents`;return false}

async function loadAuth(){try{const r=await fetch(`${GAD}/${AP}`,{headers:ghH(GT)});if(r.ok)return dec((await r.json()).content);if(r.status===404){const d=[{user:'admin',pass:'admin123'}];await fetch(`${GAD}/${AP}`,{method:'PUT',headers:{'Authorization':`token ${GT}`,'Content-Type':'application/json'},body:JSON.stringify({message:'Create auth',content:enc(d)})});return d}}catch(e){}return[]}
async function loadData(){try{const r=await fetch(`${GAD}/${DP}`,{headers:ghH(GT)});if(r.ok){const d=await r.json();dataSha=d.sha;return dec(d.content)}if(r.status===404){dataSha=null;return[]}}catch(e){}return null}
async function saveData(){try{const body={message:'Update girls',content:enc(girls)};if(dataSha)body.sha=dataSha;const r=await fetch(`${GAD}/${DP}`,{method:'PUT',headers:{'Authorization':`token ${GT}`,'Content-Type':'application/json'},body:JSON.stringify(body)});if(!r.ok)throw new Error((await r.json()).message||r.status);const rd=await r.json();dataSha=rd.content.sha;return true}catch(e){showToast('Save failed: '+e.message,'error');return false}}
async function loadCalData(){try{const r=await fetch(`${GAD}/${KP}`,{headers:ghH(GT)});if(r.ok){const d=await r.json();calSha=d.sha;return dec(d.content)}if(r.status===404){calSha=null;return{}}}catch(e){}return{}}
async function saveCalData(){try{const vd=getWeekDates(),cl={};for(const n in calData){cl[n]={};for(const dt of vd){if(calData[n]&&calData[n][dt])cl[n][dt]=calData[n][dt]}}calData=cl;const body={message:'Update calendar',content:enc(calData)};if(calSha)body.sha=calSha;const r=await fetch(`${GAD}/${KP}`,{method:'PUT',headers:{'Authorization':`token ${GT}`,'Content-Type':'application/json'},body:JSON.stringify(body)});if(!r.ok)throw new Error(r.status);calSha=(await r.json()).content.sha;return true}catch(e){showToast('Calendar save failed','error');return false}}

async function uploadToGithub(b64,name,fn){const safe=name.replace(/[^a-zA-Z0-9_-]/g,'_'),path=`Images/${safe}/${fn}`,pure=b64.split(',')[1];let sha;try{const c=await fetch(`${GA}/${path}`,{headers:{'Authorization':`token ${GT}`}});if(c.ok)sha=(await c.json()).sha}catch(e){}const body={message:`Upload ${path}`,content:pure};if(sha)body.sha=sha;const r=await fetch(`${GA}/${path}`,{method:'PUT',headers:{'Authorization':`token ${GT}`,'Content-Type':'application/json'},body:JSON.stringify(body)});if(!r.ok)throw new Error(r.status);return`https://raw.githubusercontent.com/${GR}/main/${path}`}
async function deleteFromGithub(url){try{const m=url.match(/raw\.githubusercontent\.com\/([^/]+\/[^/]+)\/[^/]+\/(.+?)(\?|$)/);if(!m)return;const api=`https://api.github.com/repos/${m[1]}/contents/${decodeURIComponent(m[2])}`;const c=await fetch(api,{headers:{'Authorization':`token ${GT}`}});if(!c.ok)return;await fetch(api,{method:'DELETE',headers:{'Authorization':`token ${GT}`,'Content-Type':'application/json'},body:JSON.stringify({message:'Delete',sha:(await c.json()).sha})})}catch(e){}}
function genFn(){return'img_'+Date.now()+'_'+Math.random().toString(36).substr(2,6)+'.jpg'}

let formNewFiles=[],girls=[],activeLocation="All",deleteTarget=-1,currentProfileIdx=0;
let rosterDateFilter=null,rosterLocFilter=null,calLocFilter=null,calPending={};
let ngIdx=0,ngList=[];
let copyTimeResolve=null;
const allPages=['homePage','rosterPage','listPage','calendarPage','profilePage'].map(id=>document.getElementById(id));

function showPage(id){
if(document.getElementById('calendarPage').classList.contains('active')&&id!=='calendarPage'){let s=false;for(const n in calPending)for(const dt in calPending[n])if(calPending[n][dt]&&calData[n]&&calData[n][dt]){delete calData[n][dt];s=true}if(s){saveCalData();renderRoster();renderGrid()}calPending={}}
allPages.forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');
document.querySelectorAll('.nav-links a').forEach(a=>a.classList.remove('active'));
if(id==='homePage'){document.getElementById('navHome').classList.add('active');renderHome()}
if(id==='rosterPage'){document.getElementById('navRoster').classList.add('active');renderRoster()}
if(id==='listPage')document.getElementById('navGirls').classList.add('active');
if(id==='calendarPage'){document.getElementById('navCalendar').classList.add('active');calPending={};renderCalendar()}
window.scrollTo(0,0)}

document.getElementById('navHome').onclick=e=>{e.preventDefault();showPage('homePage')};
document.getElementById('navRoster').onclick=e=>{e.preventDefault();showPage('rosterPage')};
document.getElementById('navGirls').onclick=e=>{e.preventDefault();showPage('listPage')};
document.getElementById('navCalendar').onclick=e=>{e.preventDefault();showPage('calendarPage')};


function fmtTime12(t){if(!t)return'';const[h,m]=t.split(':').map(Number);const ap=h<12?'AM':'PM';const hr=h===0?12:h>12?h-12:h;return hr+':'+String(m).padStart(2,'0')+' '+ap}
function getCalEntry(name,date){if(calData[name]&&calData[name][date]){const v=calData[name][date];return typeof v==='object'?v:{start:'',end:''};}return null}

/* ── Find existing times for a girl on other dates ── */
function findExistingTimes(name,excludeDate){
const dates=getWeekDates();
for(const dt of dates){
if(dt===excludeDate)continue;
const entry=getCalEntry(name,dt);
if(entry&&entry.start&&entry.end)return{date:dt,start:entry.start,end:entry.end}}
return null}

/* ── Copy Time Modal ── */
function closeCopyTimeModal(result){
const modal=document.getElementById('copyTimeModal');
modal.classList.remove('open');
if(copyTimeResolve){copyTimeResolve(result);copyTimeResolve=null}}

function showCopyTimePrompt(name,sourceDate,start,end){
return new Promise(resolve=>{
const modal=document.getElementById('copyTimeModal');
const f=dispDate(sourceDate);
document.getElementById('copyTimeMsg').innerHTML=`<strong style="color:#fff">${name}</strong> has existing times from <strong style="color:#fff">${f.day} ${f.date}</strong>`;
document.getElementById('copyTimeDetail').textContent=fmtTime12(start)+' — '+fmtTime12(end);
copyTimeResolve=resolve;
modal.classList.add('open')})}

document.getElementById('copyTimeCopy').onclick=()=>closeCopyTimeModal('copy');
document.getElementById('copyTimeNew').onclick=()=>closeCopyTimeModal('new');
document.getElementById('copyTimeCancel').onclick=()=>closeCopyTimeModal('cancel');
document.getElementById('copyTimeModal').onclick=e=>{if(e.target===document.getElementById('copyTimeModal'))closeCopyTimeModal('cancel')};
window.addEventListener('beforeunload',()=>closeCopyTimeModal('cancel'));

/* ── Home Page ── */
function getNewGirls(){
const now=getAEDTDate();const cutoff=new Date(now);cutoff.setDate(cutoff.getDate()-28);
return girls.filter(g=>{if(!g.startDate)return false;const sd=new Date(g.startDate+'T00:00:00');return sd>=cutoff&&sd<=now})}

function renderHome(){
const c=document.getElementById('homeImages');c.innerHTML='';
const baseUrl='https://raw.githubusercontent.com/sydneyginza/sydneyginza.github.io/main/Images/Homepage/Homepage_';
for(let i=1;i<=4;i++){const card=document.createElement('div');card.className='home-img-card';card.style.cursor='default';card.innerHTML=`<img src="${baseUrl}${i}.jpg">`;c.appendChild(card)}
const ann=document.getElementById('homeAnnounce');ann.innerHTML='<p></p>';
ngList=getNewGirls();ngIdx=0;renderNewGirls()}

function renderNewGirls(){
const nav=document.getElementById('ngNav'),disp=document.getElementById('ngDisplay');
nav.innerHTML='';disp.innerHTML='';
if(!ngList.length){disp.innerHTML='<div class="ng-empty">No new girls this month</div>';return}
if(ngIdx>=ngList.length)ngIdx=0;if(ngIdx<0)ngIdx=ngList.length-1;
const up=document.createElement('button');up.className='ng-arrow';up.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>';
up.onclick=()=>{ngIdx=(ngIdx-1+ngList.length)%ngList.length;renderNewGirls()};nav.appendChild(up);
const dots=document.createElement('div');dots.className='ng-dots';
const mx=3;let st=Math.max(0,ngIdx-Math.floor(mx/2)),en=Math.min(ngList.length,st+mx);if(en-st<mx)st=Math.max(0,en-mx);
for(let i=st;i<en;i++){const dot=document.createElement('button');dot.className='ng-dot'+(i===ngIdx?' active':'');
const g=ngList[i];dot.innerHTML=g.photos&&g.photos.length?`<img src="${g.photos[0]}">`:`<span>${g.name.charAt(0)}</span>`;
dot.onclick=()=>{ngIdx=i;renderNewGirls()};dots.appendChild(dot)}
nav.appendChild(dots);
const ctr=document.createElement('div');ctr.className='ng-counter';ctr.innerHTML=`<span>${ngIdx+1}</span> / ${ngList.length}`;nav.appendChild(ctr);
const dn=document.createElement('button');dn.className='ng-arrow';dn.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>';
dn.onclick=()=>{ngIdx=(ngIdx+1)%ngList.length;renderNewGirls()};nav.appendChild(dn);
const g=ngList[ngIdx],ri=girls.indexOf(g);
const photo=g.photos&&g.photos.length?`<img src="${g.photos[0]}">`:'<div class="ng-placeholder"></div>';
disp.innerHTML=`<div class="ng-card"><div class="ng-photo" data-idx="${ri}" style="cursor:pointer">${photo}</div><a class="ng-name" data-idx="${ri}">${g.name}</a></div>`;
disp.querySelector('.ng-photo').onclick=()=>{profileReturnPage='homePage';showProfile(ri)};
disp.querySelector('.ng-name').onclick=()=>{profileReturnPage='homePage';showProfile(ri)}}

let lbPhotos=[],lbIdx=0;const lightbox=document.getElementById('lightbox'),lbImg=document.getElementById('lbImg');
document.getElementById('lbClose').onclick=()=>lightbox.classList.remove('open');
lightbox.onclick=e=>{if(e.target===lightbox)lightbox.classList.remove('open')};
document.getElementById('lbPrev').onclick=()=>{lbIdx=(lbIdx-1+lbPhotos.length)%lbPhotos.length;lbImg.src=lbPhotos[lbIdx]};
document.getElementById('lbNext').onclick=()=>{lbIdx=(lbIdx+1)%lbPhotos.length;lbImg.src=lbPhotos[lbIdx]};
function openLightbox(p,i){lbPhotos=p;lbIdx=i;lbImg.src=p[i];lightbox.classList.add('open')}

function renderProfileNav(idx){const rail=document.getElementById('profileNavRail'),total=girls.length;rail.innerHTML='';
const up=document.createElement('button');up.className='pnav-arrow';up.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>';up.onclick=()=>showProfile(idx<=0?total-1:idx-1);rail.appendChild(up);
const dots=document.createElement('div');dots.className='pnav-dots';const mx=5;let st=Math.max(0,idx-Math.floor(mx/2)),en=Math.min(total,st+mx);if(en-st<mx)st=Math.max(0,en-mx);
for(let i=st;i<en;i++){const d=document.createElement('button');d.className='pnav-dot'+(i===idx?' active':'');const g=girls[i];d.innerHTML=g.photos&&g.photos.length?`<div class="dot-inner"><img src="${g.photos[0]}"></div>`:`<div class="dot-inner"><span class="dot-letter">${g.name.charAt(0)}</span></div>`;d.onclick=()=>showProfile(i);dots.appendChild(d)}
rail.appendChild(dots);const ctr=document.createElement('div');ctr.className='pnav-counter';ctr.innerHTML=`<span>${idx+1}</span> / ${total}`;rail.appendChild(ctr);
const dn=document.createElement('button');dn.className='pnav-arrow';dn.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>';dn.onclick=()=>showProfile(idx>=total-1?0:idx+1);rail.appendChild(dn)}

function showProfile(idx){
const g=girls[idx];if(!g)return;currentProfileIdx=idx;if(!g.photos)g.photos=[];
const mainImg=g.photos.length?`<img src="${g.photos[0]}">`:'<div class="silhouette"></div>';
const admin=loggedIn?`<div class="profile-actions"><button class="btn btn-primary" id="profEdit">Edit Profile</button><button class="btn btn-danger" id="profDelete">Delete</button></div>`:'';
const ts=fmtDate(getAEDTDate());const entry=getCalEntry(g.name,ts);
let availHtml='';if(entry&&entry.start&&entry.end)availHtml='<span class="dim">|</span><span style="color:#00c864;font-weight:600">Available Today ('+fmtTime12(entry.start)+' - '+fmtTime12(entry.end)+')</span>';
const stats=[{l:'Age',v:g.age},{l:'Body Size',v:g.body},{l:'Height',v:g.height+' cm'},{l:'Cup Size',v:g.cup},{l:'Value 1',v:g.val1||'\u2014'},{l:'Value 2',v:g.val2||'\u2014'},{l:'Value 3',v:g.val3||'\u2014'},{l:'Experience',v:g.exp||'\u2014'}];
document.getElementById('profileContent').innerHTML=`<button class="back-btn" id="backBtn"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>Back</button>
<div class="profile-layout"><div class="profile-image-area"><div class="profile-main-img" id="profMainImg">${mainImg}</div><div class="profile-thumbs" id="profThumbs"></div></div>
<div class="profile-details"><div class="profile-name">${g.name}</div><div class="profile-meta"><span>${g.location}</span><span class="dim">|</span><span>${g.country}</span>${availHtml}</div><div class="profile-divider"></div>
<div class="profile-stats">${stats.map(s=>`<div class="profile-stat"><div class="p-label">${s.l}</div><div class="p-val">${s.v}</div></div>`).join('')}</div>
<div class="profile-desc-title">Language</div><div class="profile-desc" style="margin-bottom:24px">${g.lang||'\u2014'}</div>
<div class="profile-desc-title">Type</div><div class="profile-desc" style="margin-bottom:24px">${g.type||'\u2014'}</div>
<div class="profile-desc-title">Description</div><div class="profile-desc">${g.desc}</div>${admin}</div></div>`;
document.getElementById('backBtn').onclick=()=>showPage(profileReturnPage);
if(loggedIn){document.getElementById('profEdit').onclick=()=>openForm(idx);document.getElementById('profDelete').onclick=()=>openDelete(idx)}
renderThumbs(idx);renderProfileNav(idx);allPages.forEach(p=>p.classList.remove('active'));document.getElementById('profilePage').classList.add('active');document.querySelectorAll('.nav-links a').forEach(a=>a.classList.remove('active'));window.scrollTo(0,0)}

function renderThumbs(idx){const g=girls[idx],c=document.getElementById('profThumbs');c.innerHTML='';
g.photos.forEach((src,i)=>{const w=document.createElement('div');w.className='thumb-wrap';const t=document.createElement('div');t.className='profile-thumb'+(i===0?' active':'');t.innerHTML=`<img src="${src}">`;
t.onclick=()=>{document.getElementById('profMainImg').innerHTML=`<img src="${src}">`;c.querySelectorAll('.profile-thumb').forEach(x=>x.classList.remove('active'));t.classList.add('active')};
t.ondblclick=()=>openLightbox(g.photos,i);w.appendChild(t);
if(loggedIn){const rm=document.createElement('button');rm.className='profile-thumb-remove';rm.innerHTML='&#x2715;';rm.onclick=async e=>{e.stopPropagation();if(src.includes('githubusercontent.com'))await deleteFromGithub(src);g.photos.splice(i,1);await saveData();showProfile(idx);renderGrid();renderRoster();renderHome();showToast('Photo removed')};w.appendChild(rm)}c.appendChild(w)})}

const loginIconBtn=document.getElementById('loginIconBtn'),userDropdown=document.getElementById('userDropdown');
function renderDropdown(){
if(loggedIn){loginIconBtn.classList.add('logged-in');userDropdown.innerHTML=`<div class="dropdown-header"><div class="label">Signed in as</div><div class="user">${(loggedInUser||'ADMIN').toUpperCase()}</div></div><button class="dropdown-item danger" id="logoutBtn">Sign Out</button>`;
document.getElementById('logoutBtn').onclick=()=>{loggedIn=false;loggedInUser=null;loginIconBtn.classList.remove('logged-in');userDropdown.classList.remove('open');document.getElementById('navCalendar').style.display='none';if(document.getElementById('calendarPage').classList.contains('active'))showPage('homePage');renderDropdown();renderFilters();renderGrid();renderRoster();renderHome()}}
else{loginIconBtn.classList.remove('logged-in');userDropdown.innerHTML=`<div class="login-form-inline"><div class="lf-title">Sign In</div><div class="lf-group"><label class="lf-label">Username</label><input class="lf-input" id="lfUser" placeholder="Username" autocomplete="off"></div><div class="lf-group"><label class="lf-label">Password</label><input class="lf-input" id="lfPass" type="password" placeholder="Password"></div><button class="lf-btn" id="lfBtn">Access</button><div class="lf-error" id="lfError"></div></div>`;
document.getElementById('lfBtn').onclick=doLogin;document.getElementById('lfPass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin()});document.getElementById('lfUser').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('lfPass').focus()})}}
function doLogin(){const u=document.getElementById('lfUser').value.trim(),p=document.getElementById('lfPass').value;const match=CRED.find(c=>c.user===u&&c.pass===p);
if(match){loggedIn=true;loggedInUser=match.user;document.getElementById('navCalendar').style.display='';renderDropdown();renderFilters();renderGrid();renderRoster();renderHome();if(document.getElementById('profilePage').classList.contains('active'))showProfile(currentProfileIdx);setTimeout(()=>userDropdown.classList.remove('open'),600);showToast('Signed in as '+match.user.toUpperCase())}
else{document.getElementById('lfError').textContent='Invalid credentials.';document.getElementById('lfPass').value=''}}
loginIconBtn.onclick=e=>{e.stopPropagation();userDropdown.classList.toggle('open')};document.addEventListener('click',e=>{if(!e.target.closest('#userDropdown')&&!e.target.closest('#loginIconBtn'))userDropdown.classList.remove('open')});renderDropdown();

const particlesEl=document.getElementById('particles');for(let i=0;i<30;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.animationDuration=(8+Math.random()*12)+'s';p.style.animationDelay=Math.random()*10+'s';p.style.width=p.style.height=(1+Math.random()*2)+'px';particlesEl.appendChild(p)}

function renderFilters(){const locs=["All",...new Set(girls.map(g=>g.location))];const fb=document.getElementById('filterBar');fb.innerHTML='';
locs.forEach(c=>{const b=document.createElement('button');b.className='filter-btn'+(c===activeLocation?' active':'');b.textContent=c;b.onclick=()=>{activeLocation=c;renderFilters();renderGrid()};fb.appendChild(b)});
if(loggedIn){const ab=document.createElement('button');ab.className='add-btn';ab.innerHTML='+ Add Girl';ab.onclick=()=>openForm();fb.appendChild(ab)}}

const grid=document.getElementById('girlsGrid');
function renderGrid(){const filtered=activeLocation==='All'?girls:girls.filter(g=>g.location===activeLocation);grid.innerHTML='';const ts=fmtDate(getAEDTDate());
filtered.forEach(g=>{const ri=girls.indexOf(g);const card=document.createElement('div');card.className='girl-card';
const act=loggedIn?`<div class="card-actions"><button class="card-action-btn edit" title="Edit" data-idx="${ri}">&#x270E;</button><button class="card-action-btn delete" title="Delete" data-idx="${ri}">&#x2715;</button></div>`:'';
const img=g.photos&&g.photos.length?`<img class="card-thumb" src="${g.photos[0]}">`:'<div class="silhouette"></div>';const entry=getCalEntry(g.name,ts);
const avail=entry&&entry.start&&entry.end?`<div class="card-avail">Available Today (${fmtTime12(entry.start)} - ${fmtTime12(entry.end)})</div>`:'';
card.innerHTML=`<div class="card-img" style="background:linear-gradient(135deg,rgba(180,74,255,0.06),rgba(255,111,0,0.03))">${img}${act}</div><div class="card-info"><div class="card-name">${g.name}</div><div class="card-country">${g.country}</div>${avail}<div class="card-hover-line"></div></div>`;
card.onclick=e=>{if(e.target.closest('.card-action-btn'))return;profileReturnPage='listPage';showProfile(ri)};
if(loggedIn){card.querySelector('.edit').onclick=e=>{e.stopPropagation();openForm(ri)};card.querySelector('.delete').onclick=e=>{e.stopPropagation();openDelete(ri)}}grid.appendChild(card)})}

function renderRosterFilters(){const fb=document.getElementById('rosterFilterBar');fb.innerHTML='';const dates=getWeekDates();const ts=dates[0];if(!rosterDateFilter)rosterDateFilter=ts;
dates.forEach(ds=>{const f=dispDate(ds);const b=document.createElement('button');b.className='filter-btn'+(ds===rosterDateFilter?' date-active':'');b.textContent=ds===ts?'Today':f.day+' '+f.date;b.onclick=()=>{rosterDateFilter=ds;renderRosterFilters();renderRosterGrid()};fb.appendChild(b)});
const sep=document.createElement('div');sep.className='filter-sep';fb.appendChild(sep);const locs=["All",...new Set(girls.map(g=>g.location))];if(!rosterLocFilter)rosterLocFilter='All';
locs.forEach(loc=>{const b=document.createElement('button');b.className='filter-btn'+(rosterLocFilter===loc?' active':'');b.textContent=loc;b.onclick=()=>{rosterLocFilter=loc;renderRosterFilters();renderRosterGrid()};fb.appendChild(b)})}
function renderRosterGrid(){const rg=document.getElementById('rosterGrid');rg.innerHTML='';const ts=fmtDate(getAEDTDate());const ds=rosterDateFilter||ts;
let filtered=girls.filter(g=>{const e=getCalEntry(g.name,ds);return e&&e.start&&e.end});
if(rosterLocFilter&&rosterLocFilter!=='All')filtered=filtered.filter(g=>g.location===rosterLocFilter);
if(!filtered.length){rg.innerHTML='<div class="empty-msg">No girls available for this date</div>';return}
filtered.forEach(g=>{const ri=girls.indexOf(g);const card=document.createElement('div');card.className='girl-card';const img=g.photos&&g.photos.length?`<img class="card-thumb" src="${g.photos[0]}">`:'<div class="silhouette"></div>';const isToday=ds===ts;const entry=getCalEntry(g.name,ds);
const timeStr=entry&&entry.start&&entry.end?' ('+fmtTime12(entry.start)+' - '+fmtTime12(entry.end)+')':'';
const avail=isToday?`<div class="card-avail">Available Today${timeStr}</div>`:`<div class="card-avail" style="color:var(--accent)">${timeStr.trim()}</div>`;
card.innerHTML=`<div class="card-img" style="background:linear-gradient(135deg,rgba(180,74,255,0.06),rgba(255,111,0,0.03))">${img}</div><div class="card-info"><div class="card-name">${g.name}</div><div class="card-country">${g.country}</div>${avail}<div class="card-hover-line"></div></div>`;
card.onclick=()=>{profileReturnPage='rosterPage';showProfile(ri)};rg.appendChild(card)})}
function renderRoster(){renderRosterFilters();renderRosterGrid()}

function generateTimeOptions(){const o=['<option value="">--:--</option>'];for(let h=0;h<24;h++)for(let m=0;m<60;m+=30){const v=String(h).padStart(2,'0')+':'+String(m).padStart(2,'0');const h12=h===0?12:h>12?h-12:h;o.push(`<option value="${v}">${h12}:${String(m).padStart(2,'0')} ${h<12?'AM':'PM'}</option>`)}return o.join('')}

function renderCalendar(){const fb=document.getElementById('calFilterBar');fb.innerHTML='';const locs=["All",...new Set(girls.map(g=>g.location))];if(!calLocFilter)calLocFilter='All';
locs.forEach(loc=>{const b=document.createElement('button');b.className='filter-btn'+(calLocFilter===loc?' active':'');b.textContent=loc;b.onclick=()=>{calLocFilter=loc;renderCalendar()};fb.appendChild(b)});
const fg=calLocFilter==='All'?girls:girls.filter(g=>g.location===calLocFilter);const table=document.getElementById('calTable');const dates=getWeekDates();const ts=dates[0];const tOpts=generateTimeOptions();
let html='<thead><tr><th>Profile</th>';dates.forEach((ds,i)=>{const f=dispDate(ds);html+=`<th class="${i===0?'cal-today':''}">${f.date}<span class="cal-day-name">${f.day}${i===0?' (Today)':''}</span></th>`});html+='</tr></thead><tbody>';
fg.forEach(g=>{const gi=girls.indexOf(g);const av=g.photos&&g.photos.length?`<img src="${g.photos[0]}">`:`<span class="cal-letter">${g.name.charAt(0)}</span>`;
html+=`<tr><td><div class="cal-profile" data-idx="${gi}"><div class="cal-avatar">${av}</div><div><div class="cal-name">${g.name}</div><div class="cal-loc">${g.location}</div></div></div></td>`;
dates.forEach((ds,di)=>{const entry=getCalEntry(g.name,ds);const ck=entry?'checked':'';const sh=!!entry;
html+=`<td class="${di===0?'cal-today':''}"><div class="cal-cell-inner"><input type="checkbox" class="cal-check" data-name="${g.name}" data-date="${ds}" ${ck}><div class="cal-time-wrap" style="display:${sh?'flex':'none'}" data-time-name="${g.name}" data-time-date="${ds}"><div class="cal-time-row"><label>Start</label><select class="cal-time-input" data-field="start" data-tname="${g.name}" data-tdate="${ds}">${tOpts}</select></div><div class="cal-time-row"><label>End</label><select class="cal-time-input" data-field="end" data-tname="${g.name}" data-tdate="${ds}">${tOpts}</select></div><div class="cal-time-warn" data-warn-name="${g.name}" data-warn-date="${ds}"></div></div></div></td>`});html+='</tr>'});html+='</tbody>';table.innerHTML=html;

fg.forEach(g=>{getWeekDates().forEach(ds=>{const entry=getCalEntry(g.name,ds);if(entry){const ss=table.querySelector(`select[data-field="start"][data-tname="${g.name}"][data-tdate="${ds}"]`),es=table.querySelector(`select[data-field="end"][data-tname="${g.name}"][data-tdate="${ds}"]`);if(ss&&entry.start)ss.value=entry.start;if(es&&entry.end)es.value=entry.end;
if(!entry.start||!entry.end){if(!calPending[g.name])calPending[g.name]={};calPending[g.name][ds]=true;const w=table.querySelector(`[data-warn-name="${g.name}"][data-warn-date="${ds}"]`);if(w)w.textContent='Times required'}}})});

table.querySelectorAll('.cal-profile').forEach(el=>{el.onclick=()=>{profileReturnPage='calendarPage';showProfile(parseInt(el.dataset.idx))}});

/* ── Calendar checkbox handler with copy-time prompt ── */
table.querySelectorAll('.cal-check').forEach(cb=>{cb.onchange=async function(){const n=this.dataset.name,d=this.dataset.date;const tw=table.querySelector(`[data-time-name="${n}"][data-time-date="${d}"]`);
if(this.checked){
if(!calData[n])calData[n]={};
/* Check if this girl has times on another date */
const existing=findExistingTimes(n,d);
if(existing){
const choice=await showCopyTimePrompt(n,existing.date,existing.start,existing.end);
if(choice==='cancel'){
this.checked=false;if(calData[n])delete calData[n][d];if(calPending[n])delete calPending[n][d];
if(tw)tw.style.display='none';return}
if(choice==='copy'){
calData[n][d]={start:existing.start,end:existing.end};
if(tw){tw.style.display='flex';
const ss=table.querySelector(`select[data-field="start"][data-tname="${n}"][data-tdate="${d}"]`),es=table.querySelector(`select[data-field="end"][data-tname="${n}"][data-tdate="${d}"]`);
if(ss)ss.value=existing.start;if(es)es.value=existing.end;
const w=table.querySelector(`[data-warn-name="${n}"][data-warn-date="${d}"]`);if(w)w.textContent=''}
const td=this.closest('td');td.classList.add('cal-saving');await saveCalData();td.classList.remove('cal-saving');
renderRoster();renderGrid();renderHome();showToast('Times copied');return}
else{calData[n][d]={start:'',end:''};if(!calPending[n])calPending[n]={};calPending[n][d]=true;
if(tw){tw.style.display='flex';const w=table.querySelector(`[data-warn-name="${n}"][data-warn-date="${d}"]`);if(w)w.textContent='Times required'}return}}
/* No existing times found — default behavior */
calData[n][d]={start:'',end:''};if(!calPending[n])calPending[n]={};calPending[n][d]=true;
if(tw){tw.style.display='flex';const w=table.querySelector(`[data-warn-name="${n}"][data-warn-date="${d}"]`);if(w)w.textContent='Times required'}}
else{if(calData[n])delete calData[n][d];if(calPending[n])delete calPending[n][d];if(tw){tw.style.display='none';const ss=table.querySelector(`select[data-field="start"][data-tname="${n}"][data-tdate="${d}"]`),es=table.querySelector(`select[data-field="end"][data-tname="${n}"][data-tdate="${ds}"]`);if(ss)ss.value='';if(es)es.value='';const w=table.querySelector(`[data-warn-name="${n}"][data-warn-date="${d}"]`);if(w)w.textContent=''}this.closest('td').classList.add('cal-saving');await saveCalData();this.closest('td').classList.remove('cal-saving');renderRoster();renderGrid();renderHome()}}});

table.querySelectorAll('.cal-time-input').forEach(sel=>{sel.onchange=async function(){const n=this.dataset.tname,d=this.dataset.tdate,f=this.dataset.field;if(!calData[n]||!calData[n][d])return;if(typeof calData[n][d]!=='object')calData[n][d]={start:'',end:''};calData[n][d][f]=this.value;const entry=calData[n][d];const w=table.querySelector(`[data-warn-name="${n}"][data-warn-date="${d}"]`);
if(entry.start&&entry.end){this.classList.remove('invalid');if(calPending[n])delete calPending[n][d];if(w)w.textContent='';const td=this.closest('td');td.classList.add('cal-saving');await saveCalData();td.classList.remove('cal-saving');renderRoster();renderGrid();renderHome();showToast('Schedule saved')}
else{this.classList.remove('invalid');if(w)w.textContent='Times required';if(!calPending[n])calPending[n]={};calPending[n][d]=true}}});}

const formOverlay=document.getElementById('formOverlay');
const formFields=['fName','fLocation','fCountry','fAge','fBody','fHeight','fCup','fVal1','fVal2','fVal3','fExp','fStartDate','fLang','fType','fDesc'];
document.getElementById('formClose').onclick=()=>formOverlay.classList.remove('open');
document.getElementById('formCancel').onclick=()=>formOverlay.classList.remove('open');
formOverlay.onclick=e=>{if(e.target===formOverlay)formOverlay.classList.remove('open')};
let formPhotos=[],formPhotosToDelete=[],formNewPhotos=[];

function renderFormPhotos(){const g=document.getElementById('fPhotoGrid'),count=document.getElementById('fPhotoCount');g.innerHTML='';count.textContent=`(${formPhotos.length} / ${MAX_PHOTOS})`;
formPhotos.forEach((src,i)=>{const w=document.createElement('div');w.style.cssText='position:relative;display:inline-block';const t=document.createElement('div');t.style.cssText='width:64px;height:64px;border:2px solid rgba(255,255,255,0.1);overflow:hidden;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,6px 100%,0 calc(100% - 6px))';t.innerHTML=`<img src="${src}" style="width:100%;height:100%;object-fit:cover">`;
const rm=document.createElement('button');rm.style.cssText='position:absolute;top:1px;right:1px;width:18px;height:18px;background:rgba(0,0,0,0.85);border:1px solid rgba(255,68,68,0.5);color:#ff4444;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:2px;z-index:2';rm.innerHTML='&#x2715;';rm.onclick=()=>{const removed=formPhotos[i];if(removed.startsWith('data:')){const ni=formNewPhotos.indexOf(removed);if(ni>=0){formNewPhotos.splice(ni,1);formNewFiles.splice(ni,1)}}formPhotosToDelete.push(removed);formPhotos.splice(i,1);renderFormPhotos()};w.appendChild(t);w.appendChild(rm);g.appendChild(w)});
if(formPhotos.length<MAX_PHOTOS){const addBtn=document.createElement('div');addBtn.style.cssText='width:64px;height:64px;border:2px dashed rgba(180,74,255,0.3);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--accent);font-size:22px;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,6px 100%,0 calc(100% - 6px));transition:all .3s';addBtn.innerHTML='+';addBtn.onmouseenter=()=>{addBtn.style.borderColor='var(--accent)';addBtn.style.background='rgba(180,74,255,0.06)'};addBtn.onmouseleave=()=>{addBtn.style.borderColor='rgba(180,74,255,0.3)';addBtn.style.background='none'};
addBtn.onclick=()=>{const rem=MAX_PHOTOS-formPhotos.length;if(rem<=0)return;const inp=document.createElement('input');inp.type='file';inp.accept='image/*';inp.multiple=true;inp.onchange=e=>{const files=Array.from(e.target.files).slice(0,rem);let loaded=0;files.forEach(f=>{const r=new FileReader();r.onload=ev=>{formPhotos.push(ev.target.result);formNewPhotos.push(ev.target.result);formNewFiles.push(f.name);loaded++;if(loaded===files.length)renderFormPhotos()};r.readAsDataURL(f)})};inp.click()};g.appendChild(addBtn)}}

function openForm(idx=-1){document.getElementById('editIndex').value=idx;formPhotosToDelete=[];formNewPhotos=[];formNewFiles=[];
if(idx>=0){document.getElementById('formTitle').textContent='Edit Profile';const g=girls[idx];document.getElementById('fName').value=g.name;document.getElementById('fLocation').value=g.location;document.getElementById('fCountry').value=g.country;document.getElementById('fAge').value=g.age;document.getElementById('fBody').value=g.body;document.getElementById('fHeight').value=g.height;document.getElementById('fCup').value=g.cup;document.getElementById('fVal1').value=g.val1||'';document.getElementById('fVal2').value=g.val2||'';document.getElementById('fVal3').value=g.val3||'';document.getElementById('fExp').value=g.exp||'';document.getElementById('fStartDate').value=g.startDate||fmtDate(getAEDTDate());document.getElementById('fLang').value=g.lang||'';document.getElementById('fType').value=g.type||'';document.getElementById('fDesc').value=g.desc;formPhotos=[...(g.photos||[])]}
else{document.getElementById('formTitle').textContent='Add New Girl';formFields.forEach(id=>document.getElementById(id).value='');document.getElementById('fStartDate').value=fmtDate(getAEDTDate());formPhotos=[]}renderFormPhotos();formOverlay.classList.add('open')}

document.getElementById('formSave').onclick=async()=>{
const req=[{id:'fName',label:'Name'},{id:'fLocation',label:'Location'},{id:'fCountry',label:'Country'},{id:'fAge',label:'Age'},{id:'fBody',label:'Body Size'},{id:'fHeight',label:'Height'},{id:'fCup',label:'Cup Size'},{id:'fExp',label:'Experience'},{id:'fVal3',label:'Value 3'},{id:'fStartDate',label:'Start Date'},{id:'fLang',label:'Language'},{id:'fType',label:'Type'},{id:'fDesc',label:'Description'}];
for(const f of req){const el=document.getElementById(f.id);if(!el.value.trim()){el.focus();showToast(f.label+' is required','error');return}}
if(formPhotos.length===0){showToast('At least one photo is required','error');return}
const name=document.getElementById('fName').value.trim();const saveBtn=document.getElementById('formSave');saveBtn.textContent='SAVING...';saveBtn.style.pointerEvents='none';
try{for(const url of formPhotosToDelete){if(url.includes('githubusercontent.com'))await deleteFromGithub(url)}
const finalPhotos=[];for(const src of formPhotos){if(src.startsWith('data:')){if(GT){const ni=formNewPhotos.indexOf(src);finalPhotos.push(await uploadToGithub(src,name,ni>=0?formNewFiles[ni]:genFn()))}else finalPhotos.push(src)}else finalPhotos.push(src)}
const o={name,location:document.getElementById('fLocation').value.trim(),country:document.getElementById('fCountry').value.trim(),age:document.getElementById('fAge').value.trim(),body:document.getElementById('fBody').value.trim(),height:document.getElementById('fHeight').value.trim(),cup:document.getElementById('fCup').value.trim(),val1:document.getElementById('fVal1').value.trim(),val2:document.getElementById('fVal2').value.trim(),val3:document.getElementById('fVal3').value.trim(),exp:document.getElementById('fExp').value.trim(),startDate:document.getElementById('fStartDate').value.trim(),lang:document.getElementById('fLang').value.trim(),type:document.getElementById('fType').value.trim(),desc:document.getElementById('fDesc').value.trim(),photos:finalPhotos};
const idx=parseInt(document.getElementById('editIndex').value);if(idx>=0)girls[idx]=o;else girls.push(o);
if(await saveData()){formOverlay.classList.remove('open');renderFilters();renderGrid();renderRoster();renderHome();if(document.getElementById('profilePage').classList.contains('active')&&idx>=0)showProfile(idx);showToast(idx>=0?'Profile updated':'Profile added')}}catch(err){showToast('Error: '+err.message,'error')}finally{saveBtn.textContent='SAVE';saveBtn.style.pointerEvents='auto'}};

const deleteOverlay=document.getElementById('deleteOverlay');document.getElementById('deleteCancel').onclick=()=>deleteOverlay.classList.remove('open');deleteOverlay.onclick=e=>{if(e.target===deleteOverlay)deleteOverlay.classList.remove('open')};
function openDelete(idx){deleteTarget=idx;document.getElementById('deleteMsg').textContent=`Remove "${girls[idx].name}" from the roster?`;deleteOverlay.classList.add('open')}
document.getElementById('deleteConfirm').onclick=async()=>{if(deleteTarget>=0){const g=girls[deleteTarget];if(g.photos&&GT)for(const url of g.photos){if(url.includes('githubusercontent.com'))await deleteFromGithub(url)}girls.splice(deleteTarget,1);await saveData();deleteTarget=-1;deleteOverlay.classList.remove('open');renderFilters();renderGrid();renderRoster();renderHome();if(document.getElementById('profilePage').classList.contains('active'))showPage('homePage');showToast('Profile deleted')}};

(async()=>{await loadConfig();const[authData,data,cal]=await Promise.all([loadAuth(),loadData(),loadCalData()]);
if(authData&&authData.length)CRED=authData;else{CRED=[];showToast('Could not load auth','error')}
if(data!==null)girls=data;else showToast('Could not load data','error');
if(cal){for(const n in cal)for(const dt in cal[n])if(cal[n][dt]===true)cal[n][dt]={start:'',end:''};calData=cal}
rosterDateFilter=fmtDate(getAEDTDate());renderFilters();renderGrid();renderRoster();renderHome();
const ls=document.getElementById('loadingScreen');ls.classList.add('hidden');setTimeout(()=>ls.remove(),600)})();
</script>
</body>
</html>