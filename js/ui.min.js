let deleteTarget=-1,currentProfileIdx=0,rosterDateFilter=null,calPending={},gridSort="name",gridSortDir="asc";try{const e=localStorage.getItem("ginza_sort");if(e){const n=JSON.parse(e);n.s&&(gridSort=n.s),n.d&&(gridSortDir=n.d)}}catch{}function _persistSort(){try{localStorage.setItem("ginza_sort",JSON.stringify({s:gridSort,d:gridSortDir}))}catch{}}let ngIdx=0,ngList=[],copyTimeResolve=null,_savedScrollY=0,_countdownInterval=null,compareSelected=[];const COMPARE_MAX=5;function isCompareSelected(e){return compareSelected.includes(e)}function toggleCompare(e){const n=compareSelected.indexOf(e);if(n>=0)compareSelected.splice(n,1);else{if(compareSelected.length>=COMPARE_MAX)return showToast("Maximum "+COMPARE_MAX+" girls for comparison","error"),!1;compareSelected.push(e)}return updateCompareBar(),updateCompareButtons(),!0}function clearCompare(){compareSelected=[],updateCompareBar(),updateCompareButtons()}function updateCompareBar(){const e=document.getElementById("compareBar");if(!e)return;const n=compareSelected.length,a=parseInt(e.dataset.prevCount||"0");e.dataset.prevCount=n,document.getElementById("compareBarCount").textContent=n,e.classList.toggle("visible",n>0),n>a&&n>0&&(e.classList.remove("compare-pulse"),e.offsetWidth,e.classList.add("compare-pulse"),setTimeout(()=>e.classList.remove("compare-pulse"),600));const l=document.getElementById("compareOpen");l&&(l.disabled=n<2,l.style.opacity=n<2?".4":"1",l.style.pointerEvents=n<2?"none":"auto")}function updateCompareButtons(){const e=compareSelected.length;document.querySelectorAll(".card-compare").forEach(n=>{const a=n.dataset.compareName,l=compareSelected.includes(a);n.classList.toggle("active",l),n.title=l?"Remove from compare":"Add to compare";const c=n.querySelector(".compare-badge");c&&(c.textContent=e+"/"+COMPARE_MAX,c.style.display=l&&e>0?"":"none")})}let sharedFilters={nameSearch:"",country:[],ageMin:null,ageMax:null,bodyMin:null,bodyMax:null,heightMin:null,heightMax:null,cupSize:null,val1Min:null,val1Max:null,val2Min:null,val2Max:null,val3Min:null,val3Max:null,experience:null,ratingMin:null,labels:[]};function applySharedFilters(e){let n=e;if(sharedFilters.nameSearch){const a=sharedFilters.nameSearch.toLowerCase();n=n.filter(l=>l.name&&l.name.toLowerCase().includes(a))}return sharedFilters.country.length&&(n=n.filter(a=>{const l=a.country;return Array.isArray(l)?sharedFilters.country.every(c=>l.includes(c)):sharedFilters.country.length===1&&sharedFilters.country.includes(l)})),sharedFilters.ageMin!=null&&(n=n.filter(a=>{const l=parseFloat(a.age);return!isNaN(l)&&l>=sharedFilters.ageMin})),sharedFilters.ageMax!=null&&(n=n.filter(a=>{const l=parseFloat(a.age);return!isNaN(l)&&l<=sharedFilters.ageMax})),sharedFilters.bodyMin!=null&&(n=n.filter(a=>{const l=parseFloat(a.body);return!isNaN(l)&&l>=sharedFilters.bodyMin})),sharedFilters.bodyMax!=null&&(n=n.filter(a=>{const l=parseFloat(a.body);return!isNaN(l)&&l<=sharedFilters.bodyMax})),sharedFilters.heightMin!=null&&(n=n.filter(a=>{const l=parseFloat(a.height);return!isNaN(l)&&l>=sharedFilters.heightMin})),sharedFilters.heightMax!=null&&(n=n.filter(a=>{const l=parseFloat(a.height);return!isNaN(l)&&l<=sharedFilters.heightMax})),sharedFilters.cupSize&&(n=n.filter(a=>a.cup&&a.cup.toUpperCase().includes(sharedFilters.cupSize.toUpperCase()))),sharedFilters.val1Min!=null&&(n=n.filter(a=>{const l=parseFloat(a.val1);return!isNaN(l)&&l>=sharedFilters.val1Min})),sharedFilters.val1Max!=null&&(n=n.filter(a=>{const l=parseFloat(a.val1);return!isNaN(l)&&l<=sharedFilters.val1Max})),sharedFilters.val2Min!=null&&(n=n.filter(a=>{const l=parseFloat(a.val2);return!isNaN(l)&&l>=sharedFilters.val2Min})),sharedFilters.val2Max!=null&&(n=n.filter(a=>{const l=parseFloat(a.val2);return!isNaN(l)&&l<=sharedFilters.val2Max})),sharedFilters.val3Min!=null&&(n=n.filter(a=>{const l=parseFloat(a.val3);return!isNaN(l)&&l>=sharedFilters.val3Min})),sharedFilters.val3Max!=null&&(n=n.filter(a=>{const l=parseFloat(a.val3);return!isNaN(l)&&l<=sharedFilters.val3Max})),sharedFilters.labels.length&&(n=n.filter(a=>a.labels&&sharedFilters.labels.every(l=>a.labels.includes(l)))),sharedFilters.experience&&(n=n.filter(a=>a.exp===sharedFilters.experience)),sharedFilters.ratingMin!=null&&(n=n.filter(a=>{const l=a.reviews||[];return l.length?l.reduce((i,d)=>i+d.rating,0)/l.length>=sharedFilters.ratingMin:!1})),n}function hasActiveFilters(){return!!(sharedFilters.nameSearch||sharedFilters.country.length||sharedFilters.ageMin!=null||sharedFilters.ageMax!=null||sharedFilters.bodyMin!=null||sharedFilters.bodyMax!=null||sharedFilters.heightMin!=null||sharedFilters.heightMax!=null||sharedFilters.cupSize||sharedFilters.val1Min!=null||sharedFilters.val1Max!=null||sharedFilters.val2Min!=null||sharedFilters.val2Max!=null||sharedFilters.val3Min!=null||sharedFilters.val3Max!=null||sharedFilters.experience||sharedFilters.ratingMin!=null||sharedFilters.labels.length)}function countActiveFilters(){let e=0;return sharedFilters.nameSearch&&e++,sharedFilters.country.length&&e++,(sharedFilters.ageMin!=null||sharedFilters.ageMax!=null)&&e++,(sharedFilters.bodyMin!=null||sharedFilters.bodyMax!=null)&&e++,(sharedFilters.heightMin!=null||sharedFilters.heightMax!=null)&&e++,sharedFilters.cupSize&&e++,(sharedFilters.val1Min!=null||sharedFilters.val1Max!=null||sharedFilters.val2Min!=null||sharedFilters.val2Max!=null||sharedFilters.val3Min!=null||sharedFilters.val3Max!=null)&&e++,sharedFilters.experience&&e++,sharedFilters.ratingMin!=null&&e++,sharedFilters.labels.length&&e++,e}function clearAllFilters(){sharedFilters={nameSearch:"",country:[],ageMin:null,ageMax:null,bodyMin:null,bodyMax:null,heightMin:null,heightMax:null,cupSize:null,val1Min:null,val1Max:null,val2Min:null,val2Max:null,val3Min:null,val3Max:null,experience:null,ratingMin:null,labels:[]}}function filtersToQuery(){const e=new URLSearchParams;return sharedFilters.nameSearch&&e.set("search",sharedFilters.nameSearch),sharedFilters.country.length&&e.set("country",sharedFilters.country.join(",")),sharedFilters.ageMin!=null&&e.set("ageMin",sharedFilters.ageMin),sharedFilters.ageMax!=null&&e.set("ageMax",sharedFilters.ageMax),sharedFilters.bodyMin!=null&&e.set("bodyMin",sharedFilters.bodyMin),sharedFilters.bodyMax!=null&&e.set("bodyMax",sharedFilters.bodyMax),sharedFilters.heightMin!=null&&e.set("heightMin",sharedFilters.heightMin),sharedFilters.heightMax!=null&&e.set("heightMax",sharedFilters.heightMax),sharedFilters.cupSize&&e.set("cup",sharedFilters.cupSize),sharedFilters.val1Min!=null&&e.set("v1Min",sharedFilters.val1Min),sharedFilters.val1Max!=null&&e.set("v1Max",sharedFilters.val1Max),sharedFilters.val2Min!=null&&e.set("v2Min",sharedFilters.val2Min),sharedFilters.val2Max!=null&&e.set("v2Max",sharedFilters.val2Max),sharedFilters.val3Min!=null&&e.set("v3Min",sharedFilters.val3Min),sharedFilters.val3Max!=null&&e.set("v3Max",sharedFilters.val3Max),sharedFilters.experience&&e.set("exp",sharedFilters.experience),sharedFilters.labels.length&&e.set("labels",sharedFilters.labels.join(",")),sharedFilters.ratingMin!=null&&e.set("rating",sharedFilters.ratingMin),gridSort!=="name"&&e.set("sort",gridSort),gridSortDir!=="asc"&&e.set("sortDir",gridSortDir),e}function queryToFilters(){const e=new URLSearchParams(window.location.search);if(e.has("search")&&(sharedFilters.nameSearch=e.get("search")),e.has("country")&&(sharedFilters.country=e.get("country").split(",").filter(Boolean)),e.has("ageMin")){const n=parseFloat(e.get("ageMin"));isNaN(n)||(sharedFilters.ageMin=n)}if(e.has("ageMax")){const n=parseFloat(e.get("ageMax"));isNaN(n)||(sharedFilters.ageMax=n)}if(e.has("bodyMin")){const n=parseFloat(e.get("bodyMin"));isNaN(n)||(sharedFilters.bodyMin=n)}if(e.has("bodyMax")){const n=parseFloat(e.get("bodyMax"));isNaN(n)||(sharedFilters.bodyMax=n)}if(e.has("heightMin")){const n=parseFloat(e.get("heightMin"));isNaN(n)||(sharedFilters.heightMin=n)}if(e.has("heightMax")){const n=parseFloat(e.get("heightMax"));isNaN(n)||(sharedFilters.heightMax=n)}if(e.has("cup")&&(sharedFilters.cupSize=e.get("cup")),e.has("v1Min")){const n=parseFloat(e.get("v1Min"));isNaN(n)||(sharedFilters.val1Min=n)}if(e.has("v1Max")){const n=parseFloat(e.get("v1Max"));isNaN(n)||(sharedFilters.val1Max=n)}if(e.has("v2Min")){const n=parseFloat(e.get("v2Min"));isNaN(n)||(sharedFilters.val2Min=n)}if(e.has("v2Max")){const n=parseFloat(e.get("v2Max"));isNaN(n)||(sharedFilters.val2Max=n)}if(e.has("v3Min")){const n=parseFloat(e.get("v3Min"));isNaN(n)||(sharedFilters.val3Min=n)}if(e.has("v3Max")){const n=parseFloat(e.get("v3Max"));isNaN(n)||(sharedFilters.val3Max=n)}if(e.has("exp")&&(sharedFilters.experience=e.get("exp")),e.has("labels")&&(sharedFilters.labels=e.get("labels").split(",").filter(Boolean)),e.has("rating")){const n=parseFloat(e.get("rating"));isNaN(n)||(sharedFilters.ratingMin=n)}if(e.has("sort")){const n=["name","newest","age","body","height","cup","lastSeen"],a=e.get("sort");n.includes(a)&&(gridSort=a)}if(e.has("sortDir")){const n=e.get("sortDir");(n==="asc"||n==="desc")&&(gridSortDir=n)}}function pushFiltersToURL(){const n=filtersToQuery().toString(),a=window.location.pathname+(n?"?"+n:"");history.replaceState({path:window.location.pathname},document.title,a)}function getDataRange(e,n){const l=girls.filter(i=>i.name&&String(i.name).trim().length>0).map(i=>parseFloat(i[e])).filter(i=>!isNaN(i)&&i>0);if(!l.length)return{min:"Min",max:"Max",rawMin:null,rawMax:null};const c=n||"";return{min:c+Math.min(...l),max:c+Math.max(...l),rawMin:Math.min(...l),rawMax:Math.max(...l)}}function makeRangeSection(e,n,a,l,c){const i=document.createElement("div");i.className="fp-section";const d=getDataRange(l,c),r=sharedFilters[n]!=null?sharedFilters[n]:d.rawMin!=null?d.rawMin:"",s=sharedFilters[a]!=null?sharedFilters[a]:d.rawMax!=null?d.rawMax:"",o=d.rawMin!=null?` min="${d.rawMin}"`:"",u=d.rawMax!=null?` max="${d.rawMax}"`:"";return i.innerHTML=`<div class="fp-title">${e}</div><div class="fp-range"><div class="fp-range-row"><input class="fp-range-input" type="number" placeholder="${d.min}" data-fkey="${n}" data-default="${d.rawMin!=null?d.rawMin:""}"${o}${u} value="${r}"><span class="fp-range-sep">${t("fp.rangeSep")}</span><input class="fp-range-input" type="number" placeholder="${d.max}" data-fkey="${a}" data-default="${d.rawMax!=null?d.rawMax:""}"${o}${u} value="${s}"></div></div>`,i}function renderFilterPane(e){const n=document.getElementById(e);if(!n)return;n.innerHTML="";const a=girls.filter(r=>r.name&&String(r.name).trim().length>0),l=[...new Set(a.flatMap(r=>Array.isArray(r.country)?r.country:[r.country]).filter(Boolean))].sort(),c=[...new Set(a.map(r=>r.cup).filter(Boolean))].sort(),i=[...new Set(a.map(r=>r.exp).filter(Boolean))].sort(),d=[...new Set(a.flatMap(r=>r.labels||[]).filter(Boolean))].sort();if(a.length){const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.search")}</div><input class="fp-range-input" type="text" data-role="name-search" placeholder="${t("ui.search")}" style="text-align:left;padding:6px 10px;width:100%">`,n.appendChild(r);const s=r.querySelector('[data-role="name-search"]');s.value=sharedFilters.nameSearch||"";let o;s.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{sharedFilters.nameSearch=s.value.trim(),renderFilters(),renderGrid(),renderRoster(),document.getElementById("calendarPage").classList.contains("active")&&renderCalendar(),document.querySelectorAll('[data-role="name-search"]').forEach(u=>{u!==s&&(u.value=sharedFilters.nameSearch)})},300)}),n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}))}{n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}));const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.rating")}</div><div class="fp-rating-options"></div>`,n.appendChild(r);const s=r.querySelector(".fp-rating-options");for(let o=5;o>=1;o--){const u=document.createElement("button");u.className="fp-option fp-rating-opt"+(sharedFilters.ratingMin===o?" active":"");const m=a.filter(p=>{const g=p.reviews||[];return g.length?g.reduce((y,M)=>y+M.rating,0)/g.length>=o:!1}).length;u.innerHTML=`<span class="fp-check">${sharedFilters.ratingMin===o?"âœ“":""}</span><span class="fp-rating-stars">${renderStarsStatic(o)}</span><span class="fp-rating-label">& up</span><span class="fp-count">${m}</span>`,u.onclick=()=>{sharedFilters.ratingMin=sharedFilters.ratingMin===o?null:o,onFiltersChanged()},s.appendChild(u)}}if(l.length){const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.country")}</div><div class="fp-options"></div>`,n.appendChild(r);const s=r.querySelector(".fp-options");l.forEach(o=>{const u=document.createElement("button");u.className="fp-option"+(sharedFilters.country.includes(o)?" active":"");const m=a.filter(p=>{const g=p.country;return Array.isArray(g)?g.includes(o):g===o}).length;u.innerHTML=`<span class="fp-check">${sharedFilters.country.includes(o)?"âœ“":""}</span>${o}<span class="fp-count">${m}</span>`,u.onclick=()=>{sharedFilters.country.includes(o)?sharedFilters.country=sharedFilters.country.filter(p=>p!==o):sharedFilters.country.push(o),onFiltersChanged()},s.appendChild(u)})}if(n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.age"),"ageMin","ageMax","age")),n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.bodySize"),"bodyMin","bodyMax","body")),n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.height"),"heightMin","heightMax","height")),c.length){n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}));const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.cupSize")}</div><div class="fp-options"></div>`,n.appendChild(r);const s=r.querySelector(".fp-options");c.forEach(o=>{const u=document.createElement("button");u.className="fp-option"+(sharedFilters.cupSize===o?" active":"");const m=a.filter(p=>p.cup===o).length;u.innerHTML=`<span class="fp-check">${sharedFilters.cupSize===o?"âœ“":""}</span>${o}<span class="fp-count">${m}</span>`,u.onclick=()=>{sharedFilters.cupSize=sharedFilters.cupSize===o?null:o,onFiltersChanged()},s.appendChild(u)})}if(n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.rates30"),"val1Min","val1Max","val1","$")),n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.rates45"),"val2Min","val2Max","val2","$")),n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"})),n.appendChild(makeRangeSection(t("fp.rates60"),"val3Min","val3Max","val3","$")),i.length){n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}));const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.experience")}</div><div class="fp-options"></div>`,n.appendChild(r);const s=r.querySelector(".fp-options");i.forEach(o=>{const u=document.createElement("button");u.className="fp-option"+(sharedFilters.experience===o?" active":"");const m=a.filter(g=>g.exp===o).length,p=o==="Experienced"?t("exp.experienced"):o==="Inexperienced"?t("exp.inexperienced"):o;u.innerHTML=`<span class="fp-check">${sharedFilters.experience===o?"âœ“":""}</span>${p}<span class="fp-count">${m}</span>`,u.onclick=()=>{sharedFilters.experience=sharedFilters.experience===o?null:o,onFiltersChanged()},s.appendChild(u)})}if(d.length){n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}));const r=document.createElement("div");r.className="fp-section",r.innerHTML=`<div class="fp-title">${t("fp.labels")}</div><div class="fp-options"></div>`,n.appendChild(r);const s=r.querySelector(".fp-options");d.forEach(o=>{const u=sharedFilters.labels.includes(o),m=document.createElement("button");m.className="fp-option"+(u?" active":"");const p=a.filter(g=>g.labels&&g.labels.includes(o)).length;m.innerHTML=`<span class="fp-check">${u?"âœ“":""}</span>${o}<span class="fp-count">${p}</span>`,m.onclick=()=>{u?sharedFilters.labels=sharedFilters.labels.filter(g=>g!==o):sharedFilters.labels.push(o),onFiltersChanged()},s.appendChild(m)})}if(hasActiveFilters()){n.appendChild(Object.assign(document.createElement("div"),{className:"fp-divider"}));const r=document.createElement("button");r.className="fp-clear",r.textContent=t("fp.clearAll"),r.onclick=()=>{clearAllFilters(),onFiltersChanged()},n.appendChild(r)}n.querySelectorAll(".fp-range-input").forEach(r=>{let s;function o(){const u=r.dataset.fkey;let m=r.value.trim();if(m==="")sharedFilters[u]=null;else{let p=parseFloat(m);if(isNaN(p)){sharedFilters[u]=null;return}const g=r.hasAttribute("min")?parseFloat(r.min):null,v=r.hasAttribute("max")?parseFloat(r.max):null;g!=null&&p<g&&(p=g,r.value=p),v!=null&&p>v&&(p=v,r.value=p);const y=r.dataset.default;sharedFilters[u]=y!==""&&p===parseFloat(y)?null:p}onFiltersChanged()}r.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(o,400)}),r.addEventListener("blur",o)})}function renderActiveFilterChips(){const e=document.getElementById("activeFilterChips");if(!e)return;const n=[];if(sharedFilters.nameSearch&&n.push({label:"ðŸ” "+sharedFilters.nameSearch,rm:()=>{sharedFilters.nameSearch="",onFiltersChanged()}}),sharedFilters.country.forEach(l=>n.push({label:l,rm:()=>{sharedFilters.country=sharedFilters.country.filter(c=>c!==l),onFiltersChanged()}})),(sharedFilters.ageMin!=null||sharedFilters.ageMax!=null)&&n.push({label:"Age "+(sharedFilters.ageMin??"")+"â€“"+(sharedFilters.ageMax??""),rm:()=>{sharedFilters.ageMin=null,sharedFilters.ageMax=null,onFiltersChanged()}}),(sharedFilters.bodyMin!=null||sharedFilters.bodyMax!=null)&&n.push({label:"Body "+(sharedFilters.bodyMin??"")+"â€“"+(sharedFilters.bodyMax??""),rm:()=>{sharedFilters.bodyMin=null,sharedFilters.bodyMax=null,onFiltersChanged()}}),(sharedFilters.heightMin!=null||sharedFilters.heightMax!=null)&&n.push({label:"Height "+(sharedFilters.heightMin??"")+"â€“"+(sharedFilters.heightMax??""),rm:()=>{sharedFilters.heightMin=null,sharedFilters.heightMax=null,onFiltersChanged()}}),sharedFilters.cupSize&&n.push({label:"Cup "+sharedFilters.cupSize,rm:()=>{sharedFilters.cupSize=null,onFiltersChanged()}}),(sharedFilters.val1Min!=null||sharedFilters.val1Max!=null)&&n.push({label:"30min "+(sharedFilters.val1Min??"")+"â€“"+(sharedFilters.val1Max??""),rm:()=>{sharedFilters.val1Min=null,sharedFilters.val1Max=null,onFiltersChanged()}}),(sharedFilters.val2Min!=null||sharedFilters.val2Max!=null)&&n.push({label:"45min "+(sharedFilters.val2Min??"")+"â€“"+(sharedFilters.val2Max??""),rm:()=>{sharedFilters.val2Min=null,sharedFilters.val2Max=null,onFiltersChanged()}}),(sharedFilters.val3Min!=null||sharedFilters.val3Max!=null)&&n.push({label:"60min "+(sharedFilters.val3Min??"")+"â€“"+(sharedFilters.val3Max??""),rm:()=>{sharedFilters.val3Min=null,sharedFilters.val3Max=null,onFiltersChanged()}}),sharedFilters.experience&&n.push({label:sharedFilters.experience,rm:()=>{sharedFilters.experience=null,onFiltersChanged()}}),sharedFilters.ratingMin!=null&&n.push({label:"â˜… "+sharedFilters.ratingMin+"+ stars",rm:()=>{sharedFilters.ratingMin=null,onFiltersChanged()}}),sharedFilters.labels.forEach(l=>n.push({label:l,rm:()=>{sharedFilters.labels=sharedFilters.labels.filter(c=>c!==l),onFiltersChanged()}})),e.innerHTML="",!n.length){e.style.display="none";return}e.style.display="flex",n.forEach(l=>{const c=document.createElement("button");c.className="active-filter-chip",c.innerHTML=l.label+' <span class="chip-x">Ã—</span>',c.onclick=l.rm,e.appendChild(c)});const a=document.createElement("button");a.className="active-filter-chip chip-clear-all",a.textContent=t("fp.clearAll"),a.onclick=()=>{clearAllFilters(),onFiltersChanged()},e.appendChild(a)}function onFiltersChanged(){const e=document.activeElement&&document.activeElement.dataset&&document.activeElement.dataset.role==="name-search",n=e?document.activeElement.selectionStart:0,a=e?document.activeElement.closest(".filter-pane"):null,l=a?a.id:null;if(renderFilterPane("girlsFilterPane"),renderFilterPane("rosterFilterPane"),renderFilterPane("calFilterPane"),renderFilterPane("profileFilterPane"),renderFilters(),renderGrid(),renderRoster(),updateFilterToggle(),pushFiltersToURL(),document.getElementById("calendarPage").classList.contains("active")&&renderCalendar(),document.getElementById("profilePage").classList.contains("active")){const c=getNamedGirlIndices();c.length?c.includes(currentProfileIdx)?renderProfileNav(currentProfileIdx):showProfile(c[0]):(document.getElementById("profileContent").innerHTML='<button class="back-btn" id="backBtn"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>Back</button><div class="empty-msg">No profiles match the current filters</div>',document.getElementById("backBtn").onclick=()=>{window.history.length>1?window.history.back():showPage(profileReturnPage)})}if(l){const c=document.getElementById(l);if(c){const i=c.querySelector('[data-role="name-search"]');i&&(i.focus(),i.setSelectionRange(n,n))}}renderActiveFilterChips()}const allPages=["homePage","rosterPage","listPage","favoritesPage","valuePage","employmentPage","calendarPage","analyticsPage","profileDbPage","profilePage"].map(e=>document.getElementById(e));function showPage(e){if(resetOgMeta(),document.getElementById("calendarPage").classList.contains("active")&&e!=="calendarPage"){flushCalSave();let s=!1;for(const o in calPending)for(const u in calPending[o])calPending[o][u]&&calData[o]&&calData[o][u]&&(delete calData[o][u],s=!0);s&&(saveCalData(),renderRoster(),renderGrid()),calPending={}}const n=document.querySelector(".page.active"),a=document.getElementById(e);if(n&&n!==a){n.classList.remove("active"),n.classList.add("page-exit");const s=()=>{n.classList.remove("page-exit"),n.removeEventListener("animationend",s)};n.addEventListener("animationend",s),setTimeout(()=>{n.classList.remove("page-exit")},200)}else allPages.forEach(s=>s.classList.remove("active"));a.classList.add("active"),closeFilterPanel();const c={homePage:"Ginza Empire",rosterPage:"Ginza Empire â€“ Roster",listPage:"Ginza Empire â€“ Girls",favoritesPage:"Ginza Empire â€“ Favorites",valuePage:"Ginza Empire â€“ Rates",employmentPage:"Ginza Empire â€“ Employment",calendarPage:"Ginza Empire â€“ Calendar",analyticsPage:"Ginza Empire â€“ Analytics",profileDbPage:"Ginza Empire â€“ Profile Database"}[e]||"Ginza Empire";document.title=c,Router.push(Router.pathForPage(e),c),_activeFilterPaneId={rosterPage:"rosterFilterPane",listPage:"girlsFilterPane",calendarPage:"calFilterPane",profilePage:"profileFilterPane"}[e]||null,document.querySelectorAll(".nav-dropdown a").forEach(s=>s.classList.remove("active"));const d={homePage:"bnHome",rosterPage:"bnRoster",listPage:"bnGirls",favoritesPage:"bnFavorites"};document.querySelectorAll(".bottom-nav-item").forEach(s=>s.classList.remove("active"));const r=d[e];if(r){const s=document.getElementById(r);s&&s.classList.add("active")}e==="homePage"&&(document.getElementById("navHome").classList.add("active"),renderHome()),e==="rosterPage"&&(document.getElementById("navRoster").classList.add("active"),renderFilterPane("rosterFilterPane"),renderRoster()),e==="listPage"&&(document.getElementById("navGirls").classList.add("active"),renderFilterPane("girlsFilterPane"),renderGrid()),e==="favoritesPage"&&(document.getElementById("navFavorites").classList.add("active"),renderFavoritesGrid()),e==="valuePage"&&(document.getElementById("navValue").classList.add("active"),renderValueTable()),e==="employmentPage"&&document.getElementById("navEmployment").classList.add("active"),e==="calendarPage"&&(document.getElementById("navCalendar").classList.add("active"),calPending={},renderFilterPane("calFilterPane"),renderCalendar()),e==="analyticsPage"&&(document.getElementById("navAnalytics").classList.add("active"),typeof renderAnalytics=="function"&&renderAnalytics()),e==="profileDbPage"&&(document.getElementById("navProfileDb").classList.add("active"),typeof renderProfileDb=="function"&&renderProfileDb()),updateFilterToggle(),_pagesWithFilters.includes(e)&&pushFiltersToURL(),window.scrollTo(0,0)}document.getElementById("navHome").onclick=e=>{e.preventDefault(),showPage("homePage")},document.getElementById("navRoster").onclick=e=>{e.preventDefault(),showPage("rosterPage")},document.getElementById("navGirls").onclick=e=>{e.preventDefault(),showPage("listPage")},document.getElementById("navFavorites").onclick=e=>{e.preventDefault(),showPage("favoritesPage")},document.getElementById("bnHome").onclick=()=>showPage("homePage"),document.getElementById("bnRoster").onclick=()=>showPage("rosterPage"),document.getElementById("bnGirls").onclick=()=>showPage("listPage"),document.getElementById("bnFavorites").onclick=()=>showPage("favoritesPage"),document.getElementById("navValue").onclick=e=>{e.preventDefault(),showPage("valuePage")},document.getElementById("navEmployment").onclick=e=>{e.preventDefault(),showPage("employmentPage")},document.getElementById("navCalendar").onclick=e=>{e.preventDefault(),showPage("calendarPage")},document.getElementById("navAnalytics").onclick=e=>{e.preventDefault(),showPage("analyticsPage")},document.getElementById("navProfileDb").onclick=e=>{e.preventDefault(),showPage("profileDbPage")};const navMenuBtn=document.getElementById("navMenuBtn"),navDropdown=document.getElementById("navDropdown");navMenuBtn.onclick=()=>{navMenuBtn.classList.toggle("open"),navDropdown.classList.toggle("open")};function closeNavMenu(){navMenuBtn.classList.remove("open"),navDropdown.classList.remove("open")}navDropdown.querySelectorAll("a").forEach(e=>{const n=e.onclick;e.addEventListener("click",()=>closeNavMenu())}),document.addEventListener("click",e=>{e.target.closest(".nav-menu-wrap")||closeNavMenu()});function findExistingTimes(e,n){const a=getWeekDates();for(const l of a){if(l===n)continue;const c=getCalEntry(e,l);if(c&&c.start&&c.end)return{date:l,start:c.start,end:c.end}}return null}function closeCopyTimeModal(e){document.getElementById("copyTimeModal").classList.remove("open"),copyTimeResolve&&(copyTimeResolve(e),copyTimeResolve=null)}function showCopyTimePrompt(e,n,a,l){return new Promise(c=>{const i=document.getElementById("copyTimeModal"),d=dispDate(n);document.getElementById("copyTimeMsg").innerHTML=`<strong style="color:#fff">${e}</strong> has existing times from <strong style="color:#fff">${d.day} ${d.date}</strong>`,document.getElementById("copyTimeDetail").textContent=fmtTime12(a)+" â€” "+fmtTime12(l),copyTimeResolve=c,i.classList.add("open")})}document.getElementById("copyTimeCopy").onclick=()=>closeCopyTimeModal("copy"),document.getElementById("copyTimeNew").onclick=()=>closeCopyTimeModal("new"),document.getElementById("copyTimeCancel").onclick=()=>closeCopyTimeModal("cancel"),document.getElementById("copyTimeModal").onclick=e=>{e.target===document.getElementById("copyTimeModal")&&closeCopyTimeModal("cancel")},window.addEventListener("beforeunload",()=>closeCopyTimeModal("cancel"));let copyDaySource=null,copyDayTargets=[];function openCopyDayModal(){const e=getWeekDates();copyDaySource=null,copyDayTargets=[];for(const n of e)if(getScheduledForDay(n).length>0){copyDaySource=n;break}copyDaySource||(copyDaySource=e[0]),renderCopyDayModal(),document.getElementById("copyDayModal").classList.add("open")}function getScheduledForDay(e){return girls.filter(n=>{if(!n.name)return!1;const a=getCalEntry(n.name,e);return a&&a.start&&a.end})}function renderCopyDayModal(){const e=getWeekDates(),n=e[0],a=document.getElementById("copyDaySources");a.innerHTML="",e.forEach(s=>{const o=dispDate(s),u=getScheduledForDay(s).length,m=document.createElement("button");m.className="copy-day-btn"+(s===copyDaySource?" active":"")+(u===0?" disabled":""),m.innerHTML=(s===n?t("ui.today"):o.day)+' <span style="opacity:.5;font-size:11px">('+u+")</span>",m.onclick=()=>{copyDaySource=s,copyDayTargets=copyDayTargets.filter(p=>p!==s),renderCopyDayModal()},a.appendChild(m)});const l=document.getElementById("copyDayPreview"),c=getScheduledForDay(copyDaySource);if(c.length){const s=dispDate(copyDaySource);l.innerHTML='<div class="copy-day-preview-title">'+s.day+" "+s.date+" â€” "+c.length+" girl"+(c.length>1?"s":"")+'</div><div class="copy-day-preview-list">'+c.map(o=>{const u=getCalEntry(o.name,copyDaySource);return'<div class="copy-day-preview-item"><span class="cdp-name">'+o.name+'</span><span class="cdp-time">'+fmtTime12(u.start)+" â€” "+fmtTime12(u.end)+"</span></div>"}).join("")+"</div>"}else l.innerHTML='<div class="copy-day-preview-empty">'+t("cal.noScheduled")+"</div>";const i=document.getElementById("copyDayTargets");i.innerHTML="",e.forEach(s=>{if(s===copyDaySource)return;const o=dispDate(s),u=getScheduledForDay(s).length,m=document.createElement("button");m.className="copy-day-btn"+(copyDayTargets.includes(s)?" target-active":""),m.innerHTML=(s===n?t("ui.today"):o.day)+(u>0?' <span style="opacity:.5;font-size:11px">('+u+")</span>":""),m.onclick=()=>{const p=copyDayTargets.indexOf(s);p>=0?copyDayTargets.splice(p,1):copyDayTargets.push(s),renderCopyDayModal()},i.appendChild(m)});const d=e.filter(s=>s!==copyDaySource);if(d.length>1){const s=document.createElement("button");s.className="copy-day-btn"+(copyDayTargets.length===d.length?" target-active":""),s.style.fontStyle="italic",s.textContent=t("cal.all"),s.onclick=()=>{copyDayTargets.length===d.length?copyDayTargets=[]:copyDayTargets=[...d],renderCopyDayModal()},i.appendChild(s)}const r=document.getElementById("copyDayApply");r.disabled=c.length===0||copyDayTargets.length===0,r.style.opacity=r.disabled?".4":"1",r.style.pointerEvents=r.disabled?"none":"auto"}function closeCopyDayModal(){document.getElementById("copyDayModal").classList.remove("open")}document.getElementById("copyDayCancel").onclick=closeCopyDayModal,document.getElementById("copyDayModal").onclick=e=>{e.target===document.getElementById("copyDayModal")&&closeCopyDayModal()},document.getElementById("copyDayApply").onclick=async function(){const e=getScheduledForDay(copyDaySource);if(!e.length||!copyDayTargets.length)return;const n=document.getElementById("copyDayOverwrite").checked;let a=0;copyDayTargets.forEach(l=>{e.forEach(c=>{const i=getCalEntry(c.name,copyDaySource);if(!i||!i.start||!i.end)return;const d=getCalEntry(c.name,l);d&&d.start&&d.end&&!n||(calData[c.name]||(calData[c.name]={}),calData[c.name][l]={start:i.start,end:i.end},a++)})}),a>0?(this.textContent="Saving...",this.style.pointerEvents="none",await saveCalData(),this.textContent=t("cal.copyDayBtn"),this.style.pointerEvents="auto",renderCalendar(),renderRoster(),renderGrid(),renderHome(),showToast("Copied "+e.length+" schedule"+(e.length>1?"s":"")+" to "+copyDayTargets.length+" day"+(copyDayTargets.length>1?"s":""))):showToast("Nothing to copy (all targets already have entries)","error"),closeCopyDayModal()};let bulkTimeName="",bulkTimeDays=[];function openBulkTimeModal(e){bulkTimeName=e;const n=getWeekDates();bulkTimeDays=n.filter(i=>{const d=getCalEntry(e,i);return!d||!d.start||!d.end}),bulkTimeDays.length||(bulkTimeDays=[...n]);let a="",l="";for(const i of n){const d=getCalEntry(e,i);if(d&&d.start&&d.end){a=d.start,l=d.end;break}}document.getElementById("bulkTimeName").textContent=e;const c=generateTimeOptions();document.getElementById("bulkTimeStart").innerHTML=c,document.getElementById("bulkTimeEnd").innerHTML=c,a&&(document.getElementById("bulkTimeStart").value=a),l&&(document.getElementById("bulkTimeEnd").value=l),renderBulkTimeDays(),document.getElementById("bulkTimeModal").classList.add("open")}function renderBulkTimeDays(){const e=getWeekDates(),n=e[0],a=document.getElementById("bulkTimeDays");a.innerHTML="",e.forEach(i=>{const d=dispDate(i),r=getCalEntry(bulkTimeName,i),s=document.createElement("button");s.className="copy-day-btn"+(bulkTimeDays.includes(i)?" target-active":""),s.innerHTML=(i===n?t("ui.today"):d.day)+(r&&r.start?' <span style="opacity:.4;font-size:10px">âœ“</span>':""),s.onclick=()=>{const o=bulkTimeDays.indexOf(i);o>=0?bulkTimeDays.splice(o,1):bulkTimeDays.push(i),renderBulkTimeDays()},a.appendChild(s)});const l=document.createElement("button");l.className="copy-day-btn"+(bulkTimeDays.length===e.length?" target-active":""),l.style.fontStyle="italic",l.textContent=t("cal.all"),l.onclick=()=>{bulkTimeDays.length===e.length?bulkTimeDays=[]:bulkTimeDays=[...e],renderBulkTimeDays()},a.appendChild(l);const c=document.getElementById("bulkTimeApply");c.disabled=bulkTimeDays.length===0,c.style.opacity=c.disabled?".4":"1",c.style.pointerEvents=c.disabled?"none":"auto"}function closeBulkTimeModal(){document.getElementById("bulkTimeModal").classList.remove("open")}document.getElementById("bulkTimeCancel").onclick=closeBulkTimeModal,document.getElementById("bulkTimeModal").onclick=e=>{e.target===document.getElementById("bulkTimeModal")&&closeBulkTimeModal()},document.getElementById("bulkTimeApply").onclick=async function(){const e=document.getElementById("bulkTimeStart").value,n=document.getElementById("bulkTimeEnd").value;if(!e||!n){showToast("Please set both start and end times","error");return}const a=bulkTimeName;calData[a]||(calData[a]={}),bulkTimeDays.forEach(l=>{calData[a][l]={start:e,end:n},calPending[a]&&delete calPending[a][l]}),this.textContent="Saving...",this.style.pointerEvents="none",await saveCalData(),this.textContent=t("cal.apply"),this.style.pointerEvents="auto",renderCalendar(),renderRoster(),renderGrid(),renderHome(),showToast(a+" marked available for "+bulkTimeDays.length+" day"+(bulkTimeDays.length>1?"s":"")),closeBulkTimeModal()};function getNewGirls(){const e=getAEDTDate(),n=new Date(e);return n.setDate(n.getDate()-28),girls.filter(a=>{if(!isAdmin()&&a.hidden||!a.startDate)return!1;const l=new Date(a.startDate+"T00:00:00");return l>=n&&l<=e})}function renderHome(){safeRender("Home",()=>{const e=document.getElementById("homeImages");e.innerHTML="";const n="https://raw.githubusercontent.com/sydneyginza/sydneyginza.github.io/main/Images/Homepage/Homepage_";for(let a=1;a<=4;a++){const l=document.createElement("div");l.className="home-img-card",l.style.cursor="default",l.innerHTML=`<img src="${n}${a}.jpg" alt="Ginza venue photo ${a}">`,e.appendChild(l)}document.getElementById("homeAnnounce").innerHTML="<p></p>",ngList=getNewGirls(),ngIdx=0,renderNewGirls(),renderRecentlyViewed()})}function renderRecentlyViewed(e="homeRecentlyViewed",n="homePage"){const a=document.getElementById(e);if(!a)return;const c=getRecentlyViewed().map(s=>{const o=girls.findIndex(u=>u.name===s.name);return o>=0?{g:girls[o],idx:o}:null}).filter(s=>s&&(isAdmin()||!s.g.hidden));if(!c.length){a.style.display="none";return}a.style.display="";const i="rvClearBtn_"+e;let d=`<div class="rv-header"><div class="profile-desc-title">${t("rv.title")}</div><button class="rv-clear-btn" id="${i}">${t("rv.clear")}</button></div><div class="also-avail-strip">`;c.forEach(({g:s,idx:o})=>{const u=s.name&&isAvailableNow(s.name),m=s.photos&&s.photos.length?`<img src="${s.photos[0]}" alt="${(s.name||"").replace(/"/g,"&quot;")}">`:'<div class="silhouette"></div>';d+=`<div class="also-avail-card" data-rv-idx="${o}">${m}<div class="also-avail-name">${s.name}</div>${u?'<span class="avail-now-dot"></span>':""}</div>`}),d+="</div>",a.innerHTML=d,a.querySelectorAll(".also-avail-card").forEach(s=>{s.onclick=()=>{_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage=n,showProfile(parseInt(s.dataset.rvIdx))}});const r=document.getElementById(i);r&&(r.onclick=()=>{clearRecentlyViewed(),renderRecentlyViewed(e,n)})}function renderNewGirls(){const e=document.getElementById("ngNav"),n=document.getElementById("ngDisplay");if(e.innerHTML="",n.innerHTML="",!ngList.length){n.innerHTML='<div class="ng-empty">No new girls this month</div>';return}ngIdx>=ngList.length&&(ngIdx=0),ngIdx<0&&(ngIdx=ngList.length-1);const a=document.createElement("button");a.className="ng-arrow",a.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>',a.onclick=()=>{ngIdx=(ngIdx-1+ngList.length)%ngList.length,renderNewGirls()},e.appendChild(a);const l=document.createElement("div");l.className="ng-dots";const c=3;let i=Math.max(0,ngIdx-Math.floor(c/2)),d=Math.min(ngList.length,i+c);d-i<c&&(i=Math.max(0,d-c));for(let p=i;p<d;p++){const g=document.createElement("button");g.className="ng-dot"+(p===ngIdx?" active":"");const v=ngList[p];g.innerHTML=v.photos&&v.photos.length?`<img src="${v.photos[0]}" alt="${v.name}">`:`<span>${v.name.charAt(0)}</span>`,g.onclick=()=>{ngIdx=p,renderNewGirls()},l.appendChild(g)}e.appendChild(l);const r=document.createElement("div");r.className="ng-counter",r.innerHTML=`<span>${ngIdx+1}</span> / ${ngList.length}`,e.appendChild(r);const s=document.createElement("button");s.className="ng-arrow",s.innerHTML='<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>',s.onclick=()=>{ngIdx=(ngIdx+1)%ngList.length,renderNewGirls()},e.appendChild(s);const o=ngList[ngIdx],u=girls.indexOf(o),m=o.photos&&o.photos.length?`<img src="${o.photos[0]}" alt="${o.name}">`:'<div class="ng-placeholder"></div>';n.innerHTML=`<div class="ng-card"><div class="ng-photo" data-idx="${u}" style="cursor:pointer">${m}</div><a class="ng-name" data-idx="${u}">${o.name}</a></div>`,n.querySelector(".ng-photo").onclick=()=>{_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage="homePage",showProfile(u)},n.querySelector(".ng-name").onclick=()=>{_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage="homePage",showProfile(u)}}(function(){const e=document.getElementById("homeSearchInput"),n=document.getElementById("homeSearchBtn");if(!e||!n)return;function a(){const l=e.value.trim();l&&(sharedFilters.nameSearch=l,showPage("listPage"),e.value="")}e.addEventListener("keydown",l=>{l.key==="Enter"&&a()}),n.onclick=a})();let lbPhotos=[],lbIdx=0,lbName="";const lightbox=document.getElementById("lightbox"),lbImg=document.getElementById("lbImg"),lbStrip=document.getElementById("lbStrip"),lbCounter=document.getElementById("lbCounter");function lbUpdateCounter(){lbCounter.innerHTML=`<span>${lbIdx+1}</span> / ${lbPhotos.length}`}function lbUpdateStrip(){lbStrip.querySelectorAll(".lb-strip-thumb").forEach((n,a)=>{n.classList.toggle("active",a===lbIdx)});const e=lbStrip.querySelector(".lb-strip-thumb.active");e&&e.scrollIntoView({inline:"center",block:"nearest",behavior:"smooth"})}function lbRenderStrip(){lbStrip.innerHTML="",lbPhotos.forEach((e,n)=>{const a=document.createElement("div");a.className="lb-strip-thumb"+(n===lbIdx?" active":""),a.innerHTML=`<img src="${e}" alt="${(lbName||"Photo "+(n+1)).replace(/"/g,"&quot;")}">`,a.onclick=()=>lbGoTo(n),lbStrip.appendChild(a)})}function lbGoTo(e){e!==lbIdx&&(lbImg.classList.add("lb-fade"),setTimeout(()=>{lbIdx=e,lbImg.src=lbPhotos[lbIdx],lbImg.alt=lbName||"",lbImg.onload=()=>{lbImg.classList.remove("lb-fade")},lbUpdateCounter(),lbUpdateStrip()},150))}function closeLightbox(){lightbox.classList.remove("open"),document.body.style.overflow=""}document.getElementById("lbClose").onclick=closeLightbox,lightbox.onclick=e=>{(e.target===lightbox||e.target.classList.contains("lightbox-main"))&&closeLightbox()},document.getElementById("lbPrev").onclick=e=>{e.stopPropagation(),lbGoTo((lbIdx-1+lbPhotos.length)%lbPhotos.length)},document.getElementById("lbNext").onclick=e=>{e.stopPropagation(),lbGoTo((lbIdx+1)%lbPhotos.length)};function openLightbox(e,n,a){lbPhotos=e,lbIdx=n,lbName=a||"",lbImg.src=e[n],lbImg.alt=lbName||"",lbImg.classList.remove("lb-fade"),lbUpdateCounter(),lbRenderStrip(),lightbox.classList.add("open"),document.body.style.overflow="hidden"}document.addEventListener("keydown",e=>{lightbox.classList.contains("open")&&(e.key==="Escape"&&closeLightbox(),e.key==="ArrowLeft"&&lbGoTo((lbIdx-1+lbPhotos.length)%lbPhotos.length),e.key==="ArrowRight"&&lbGoTo((lbIdx+1)%lbPhotos.length))}),function(){let e=0,n=0;const a=document.getElementById("lightbox");a.addEventListener("touchstart",l=>{e=l.touches[0].clientX,n=l.touches[0].clientY},{passive:!0}),a.addEventListener("touchend",l=>{if(!a.classList.contains("open"))return;const c=l.changedTouches[0].clientX-e,i=l.changedTouches[0].clientY-n;Math.abs(c)>50&&Math.abs(c)>Math.abs(i)&&(c<0?lbGoTo((lbIdx+1)%lbPhotos.length):lbGoTo((lbIdx-1+lbPhotos.length)%lbPhotos.length))},{passive:!0})}();function openCompareModal(){if(compareSelected.length<2)return;const e=document.getElementById("compareOverlay"),n=document.getElementById("compareGrid");if(!e||!n)return;const a=compareSelected.map(i=>girls.find(d=>d.name===i)).filter(Boolean);if(a.length<2)return;const l=[{label:t("fp.country"),fn:i=>Array.isArray(i.country)?i.country.join(", "):i.country||"â€”"},{label:t("field.age"),fn:i=>i.age||"â€”",raw:i=>parseFloat(i.age)},{label:t("fp.height"),fn:i=>i.height?i.height+" cm":"â€”",raw:i=>parseFloat(i.height)},{label:t("field.body"),fn:i=>i.body||"â€”",raw:i=>parseFloat(i.body)},{label:t("fp.cupSize"),fn:i=>i.cup||"â€”",alpha:i=>i.cup?i.cup.trim().charAt(0).toUpperCase():null},{label:t("field.rates30"),fn:i=>i.val1?"$"+i.val1:"â€”",raw:i=>parseFloat(i.val1)},{label:t("field.rates45"),fn:i=>i.val2?"$"+i.val2:"â€”",raw:i=>parseFloat(i.val2)},{label:t("field.rates60"),fn:i=>i.val3?"$"+i.val3:"â€”",raw:i=>parseFloat(i.val3)},{label:t("field.experience"),fn:i=>i.exp||"â€”",fixedColor:i=>i.exp==="Experienced"?"#00c864":i.exp==="Inexperienced"?"#ff4d4d":null},{label:t("field.labels"),fn:i=>i.labels&&i.labels.length?i.labels.slice().sort().join(", "):"â€”"}];let c='<table class="compare-stat-table"><thead><tr><th></th>';a.forEach(i=>{const d=i.photos&&i.photos.length?`<img src="${i.photos[0]}" class="compare-col-photo" alt="${i.name.replace(/"/g,"&quot;")}">`:'<div class="compare-col-photo-placeholder"></div>';c+=`<th style="text-align:center;padding-bottom:16px;vertical-align:bottom">${d}<div class="compare-col-name">${i.name}</div></th>`}),c+="</tr></thead><tbody>",l.forEach(i=>{if(c+="<tr>",c+=`<td>${i.label}</td>`,i.raw){const d=a.map(u=>i.raw(u)),r=d.filter(u=>!isNaN(u)),s=r.length?Math.max(...r):null,o=r.length?Math.min(...r):null;a.forEach((u,m)=>{const p=d[m];let g="";!isNaN(p)&&s!==null&&o!==null&&s!==o&&(p===s?g=' style="color:#ff4d4d;font-weight:600"':p===o&&(g=' style="color:#00c864;font-weight:600"')),c+=`<td${g}>${i.fn(u)}</td>`})}else if(i.alpha){const d=a.map(u=>i.alpha(u)),r=[...new Set(d.filter(Boolean))].sort(),s=r.length?r[r.length-1]:null,o=r.length?r[0]:null;a.forEach((u,m)=>{const p=d[m];let g="";p&&s&&o&&s!==o&&(p===s?g=' style="color:#ff4d4d;font-weight:600"':p===o&&(g=' style="color:#00c864;font-weight:600"')),c+=`<td${g}>${i.fn(u)}</td>`})}else i.fixedColor?a.forEach(d=>{const r=i.fixedColor(d);c+=`<td${r?` style="color:${r};font-weight:600"`:""}>${i.fn(d)}</td>`}):a.forEach(d=>{c+=`<td>${i.fn(d)}</td>`});c+="</tr>"}),c+="</tbody></table>",n.innerHTML=c,e.classList.add("open"),document.body.style.overflow="hidden"}function closeCompareModal(){const e=document.getElementById("compareOverlay");e&&e.classList.remove("open"),document.body.style.overflow=""}(function(){const e=document.getElementById("compareClear"),n=document.getElementById("compareOpen"),a=document.getElementById("compareClose"),l=document.getElementById("compareDone"),c=document.getElementById("compareOverlay");e&&(e.onclick=clearCompare),n&&(n.onclick=openCompareModal),a&&(a.onclick=closeCompareModal),l&&(l.onclick=closeCompareModal),c&&(c.onclick=i=>{i.target===c&&closeCompareModal()}),document.addEventListener("keydown",i=>{c&&c.classList.contains("open")&&i.key==="Escape"&&closeCompareModal()})})();function getNamedGirlIndices(){const e=girls.map((c,i)=>({g:c,i})).filter(c=>c.g.name&&String(c.g.name).trim().length>0&&(isAdmin()||!c.g.hidden)),n=applySharedFilters(e.map(c=>c.g)),a=e.filter(c=>n.includes(c.g));return applySortOrder(a.map(c=>c.g)).map(c=>a.find(i=>i.g===c).i)}function showProfileReplace(e){const n=Router.push;Router.push=Router.replace;try{showProfile(e)}finally{Router.push=n}}function renderProfileNav(e){const n=document.getElementById("profileNavRail");n.innerHTML="";const a=getNamedGirlIndices(),l=a.length;if(l===0)return;const c=a.indexOf(e),i=c>=0?c:0,d=a[i<=0?l-1:i-1],r=a[i>=l-1?0:i+1];[d,r].forEach(g=>{const v=girls[g];if(!v||!v.photos||!v.photos.length)return;const y=v.photos[0];if(!y||y.startsWith("data:"))return;const M="pfetch-"+g;if(!document.getElementById(M)){const w=document.createElement("link");w.rel="prefetch",w.as="image",w.href=y,w.id=M,document.head.appendChild(w)}});const s=document.createElement("button");s.className="pnav-arrow",s.innerHTML='<svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>',s.onclick=()=>showProfileReplace(d),n.appendChild(s);const o=document.createElement("div");o.className="pnav-dots";for(let g=0;g<l;g++){const v=a[g],y=document.createElement("button");y.className="pnav-dot"+(v===e?" active":"")+(girls[v].hidden?" pnav-dot-hidden":"");const M=girls[v];y.innerHTML=M.photos&&M.photos.length?`<div class="dot-inner"><img src="${M.photos[0]}" alt="${(M.name||"").replace(/"/g,"&quot;")}"></div>`:`<div class="dot-inner"><span class="dot-letter">${(M.name||"?").charAt(0)}</span></div>`,y.onclick=()=>showProfileReplace(v),o.appendChild(y)}n.appendChild(o);const u=document.createElement("div");u.className="pnav-counter",u.innerHTML=`<span>${i+1}</span> / ${l}`,n.appendChild(u);const m=document.createElement("button");m.className="pnav-arrow",m.innerHTML='<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>',m.onclick=()=>showProfileReplace(r),n.appendChild(m);const p=o.querySelector(".pnav-dot.active");p&&setTimeout(()=>p.scrollIntoView({inline:"center",block:"nearest",behavior:"smooth"}),50)}function updateOgMeta(e,n){const a=(u,m,p)=>{p=p||"property";let g=document.querySelector("meta["+p+'="'+u+'"]');g||(g=document.createElement("meta"),g.setAttribute(p,u),document.head.appendChild(g)),g.setAttribute("content",m)},l="https://sydneyginza.github.io"+Router.pathForProfile(n),c=e.photos&&e.photos.length?e.photos[0]:"https://raw.githubusercontent.com/sydneyginza/sydneyginza.github.io/main/Images/Homepage/Homepage_1.jpg",d=[Array.isArray(e.country)?e.country.join("/"):e.country||"",e.age?"Age "+e.age:"",e.body?"Body "+e.body:"",e.height?e.height+" cm":"",e.cup?e.cup+" cup":"",e.val3?"From "+e.val3+"/hr":"",e.exp||""].filter(Boolean),r=d.length?d.join(" Â· ")+" â€“ Ginza Empire, Sydney":"View profile at Ginza Empire, Sydney.",s=(e.name||"Profile")+" â€“ Ginza Empire";a("og:title",s),a("og:description",r),a("og:url",l),a("og:image",c),a("twitter:title",s,"name"),a("twitter:description",r,"name"),a("twitter:image",c,"name"),a("description",r,"name");let o=document.querySelector('link[rel="canonical"]');o||(o=document.createElement("link"),o.rel="canonical",document.head.appendChild(o)),o.href=l}function updateProfileJsonLd(e,n){let a=document.getElementById("profileLd");a||(a=document.createElement("script"),a.type="application/ld+json",a.id="profileLd",document.head.appendChild(a));const l="https://sydneyginza.github.io"+Router.pathForProfile(n),c=e.photos&&e.photos.length?e.photos[0]:"",i=Array.isArray(e.country)?e.country[0]:e.country||"",d={"@type":"Person",name:e.name||"",worksFor:{"@id":"https://sydneyginza.github.io/#empire"}};c&&(d.image=e.photos.length>1?e.photos:c),i&&(d.nationality=i),e.desc&&(d.description=e.desc.replace(/<[^>]*>/g,"").substring(0,300));const r=[];e.val1&&r.push({"@type":"Offer",name:"30 min session",price:String(e.val1).replace(/[^0-9.]/g,""),priceCurrency:"AUD"}),e.val2&&r.push({"@type":"Offer",name:"45 min session",price:String(e.val2).replace(/[^0-9.]/g,""),priceCurrency:"AUD"}),e.val3&&r.push({"@type":"Offer",name:"60 min session",price:String(e.val3).replace(/[^0-9.]/g,""),priceCurrency:"AUD"}),r.length&&(d.makesOffer=r);const s=e.reviews||[],o={"@context":"https://schema.org","@type":"ProfilePage",url:l,mainEntity:d};if(s.length){const u=s.reduce((m,p)=>m+p.rating,0)/s.length;o.mainEntity.aggregateRating={"@type":"AggregateRating",ratingValue:u.toFixed(1),bestRating:"5",ratingCount:s.length}}a.textContent=JSON.stringify(o)}function resetOgMeta(){const e=(d,r,s)=>{s=s||"property";const o=document.querySelector("meta["+s+'="'+d+'"]');o&&o.setAttribute("content",r)},n="Ginza Empire â€“ Sydney's Premier Asian Bordello",a="Sydney's premier Asian bordello in Surry Hills. Browse our roster of stunning girls, check live availability, and view rates. Open daily 10:30amâ€“1am at 310 Cleveland St.",l="https://raw.githubusercontent.com/sydneyginza/sydneyginza.github.io/main/Images/Homepage/Homepage_1.jpg";e("og:title",n),e("og:description",a),e("og:url","https://sydneyginza.github.io"),e("og:image",l),e("twitter:title",n,"name"),e("twitter:description",a,"name"),e("twitter:image",l,"name"),e("description",a,"name");const c=document.querySelector('link[rel="canonical"]');c&&(c.href="https://sydneyginza.github.io");const i=document.getElementById("profileLd");i&&i.remove()}function renderAlsoAvailable(e){const n=girls[e];if(!n)return;const a=fmtDate(getAEDTDate()),l=girls.filter(r=>{if(!r.name||r.name===n.name||!isAdmin()&&r.hidden)return!1;const s=getCalEntry(r.name,a);return s&&s.start&&s.end}).slice(0,8);if(!l.length)return;const c=document.createElement("div");c.className="profile-also";const i=document.createElement("div");i.className="profile-desc-title",i.textContent=t("ui.alsoAvail"),c.appendChild(i);const d=document.createElement("div");d.className="also-avail-strip",l.forEach(r=>{const s=girls.indexOf(r),o=isAvailableNow(r.name),u=document.createElement("div");u.className="also-avail-card";const m=r.photos&&r.photos.length?`<img src="${r.photos[0]}" alt="${r.name.replace(/"/g,"&quot;")}">`:'<div class="silhouette"></div>';u.innerHTML=`${m}<div class="also-avail-name">${r.name}</div>${o?'<span class="avail-now-dot"></span>':""}`,u.onclick=()=>showProfile(s),d.appendChild(u)}),c.appendChild(d),document.getElementById("profileContent").appendChild(c)}function _avgRate(e){const n=[parseFloat(e.val1),parseFloat(e.val2),parseFloat(e.val3)].filter(a=>!isNaN(a)&&a>0);return n.length?n.reduce((a,l)=>a+l,0)/n.length:0}function computeSimilarity(e,n){let a=0;const l=Array.isArray(e.country)?e.country:[e.country],c=Array.isArray(n.country)?n.country:[n.country];l.some(m=>m&&c.includes(m))&&(a+=1);const i=parseFloat(e.age),d=parseFloat(n.age);!isNaN(i)&&!isNaN(d)&&Math.abs(i-d)<=3&&(a+=1);const r=parseFloat(e.body),s=parseFloat(n.body);!isNaN(r)&&!isNaN(s)&&Math.abs(r-s)<=2&&(a+=1),e.cup&&n.cup&&e.cup.trim().charAt(0).toUpperCase()===n.cup.trim().charAt(0).toUpperCase()&&(a+=1);const o=_avgRate(e),u=_avgRate(n);return o>0&&u>0&&Math.abs(o-u)/Math.max(o,u)<=.2&&(a+=1),a/5}function renderSimilarGirls(e){const n=girls[e];if(!n||!n.name)return;const a=fmtDate(getAEDTDate()),l=new Set;girls.filter(s=>{if(!s.name||s.name===n.name||!isAdmin()&&s.hidden)return!1;const o=getCalEntry(s.name,a);return o&&o.start&&o.end}).slice(0,8).forEach(s=>l.add(s.name));const c=girls.map((s,o)=>({g:s,idx:o})).filter(s=>s.g.name&&s.g.name!==n.name&&!l.has(s.g.name)&&(isAdmin()||!s.g.hidden)).map(s=>({...s,score:computeSimilarity(n,s.g)})).filter(s=>s.score>=.4).sort((s,o)=>o.score-s.score).slice(0,6);if(!c.length)return;const i=document.createElement("div");i.className="profile-also";const d=document.createElement("div");d.className="profile-desc-title",d.textContent=t("sim.title"),i.appendChild(d);const r=document.createElement("div");r.className="also-avail-strip",c.forEach(s=>{const o=s.g,u=isAvailableNow(o.name),m=document.createElement("div");m.className="also-avail-card";const p=o.photos&&o.photos.length?`<img src="${o.photos[0]}" alt="${o.name.replace(/"/g,"&quot;")}">`:'<div class="silhouette"></div>';m.innerHTML=`${p}<div class="also-avail-name">${o.name}</div>${u?'<span class="avail-now-dot"></span>':""}`,m.onclick=()=>showProfile(s.idx),r.appendChild(m)}),i.appendChild(r),document.getElementById("profileContent").appendChild(i)}function updateFavBadge(){const e=document.getElementById("navFavBadge"),n=document.getElementById("bnFavBadge"),a=getFavCount();e&&(e.textContent=a>0?a:""),n&&(n.textContent=a>0?a:"")}function favHeartSvg(e){return e?'<svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg viewBox="0 0 24 24"><path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/></svg>'}const starSvgFull='<svg viewBox="0 0 24 24" width="16" height="16"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>',starSvgEmpty='<svg viewBox="0 0 24 24" width="16" height="16"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/></svg>';function renderStarsStatic(e){let n="";for(let a=1;a<=5;a++)n+='<span class="review-star'+(a<=e?" filled":"")+'">'+(a<=e?starSvgFull:starSvgEmpty)+"</span>";return n}function renderReviews(e){const n=document.getElementById("profileReviews");if(!n)return;const a=girls[e];if(!a)return;const l=a.reviews||[],c=l.length?l.reduce((o,u)=>o+u.rating,0)/l.length:0,i=loggedIn&&l.some(o=>o.user===loggedInUser);let d='<div class="profile-reviews"><div class="profile-desc-title" style="margin-top:32px">'+t("review.title");l.length&&(d+=' <span class="review-count">('+l.length+")</span>"),d+="</div>",loggedIn&&!i?d+='<button class="review-write-btn" id="rvWriteBtn">'+t("review.write")+"</button>":loggedIn||(d+='<div class="review-signin">'+t("review.signin").replace("{link}",'<a href="#" id="rvSignInLink">'+t("ui.signIn")+"</a>")+"</div>"),d+='<div id="rvFormArea"></div>',!l.length&&!loggedIn?d+='<div class="review-empty">'+t("review.noReviews")+"</div>":l.length||(d+='<div class="review-empty">'+t("review.noReviews")+"</div>"),l.slice().sort((o,u)=>new Date(u.ts)-new Date(o.ts)).forEach(o=>{const u=loggedIn&&o.user===loggedInUser,m=u||isAdmin(),g=new Date(o.ts).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"});d+='<div class="review-card"><div class="review-header"><span class="review-user">'+o.user.toUpperCase()+'</span><span class="review-stars">'+renderStarsStatic(o.rating)+'</span><span class="review-date">'+g+"</span></div>",o.text&&(d+='<div class="review-text">'+o.text.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</div>"),m&&(d+='<div class="review-actions">',(u||isAdmin())&&(d+='<button class="review-action-btn review-edit-btn" data-rv-user="'+o.user+'">'+t("review.edit")+"</button>"),d+='<button class="review-action-btn review-delete-btn" data-rv-user="'+o.user+'">'+t("review.delete")+"</button></div>"),d+="</div>"}),d+="</div>",n.innerHTML=d;const r=document.getElementById("rvWriteBtn");r&&(r.onclick=()=>openReviewForm(e,null));const s=document.getElementById("rvSignInLink");s&&(s.onclick=o=>{o.preventDefault(),showAuthSignIn()}),n.querySelectorAll(".review-edit-btn").forEach(o=>{o.onclick=()=>{const u=(a.reviews||[]).find(m=>m.user===o.dataset.rvUser);u&&openReviewForm(e,u)}}),n.querySelectorAll(".review-delete-btn").forEach(o=>{o.onclick=async()=>{if(!confirm(t("review.confirmDelete")))return;const u=o.dataset.rvUser;a.reviews=(a.reviews||[]).filter(m=>m.user!==u),await saveData()&&(showToast(t("review.deleted")),renderReviews(e))}})}function openReviewForm(e,n){const a=document.getElementById("rvFormArea");if(!a)return;const l=n?n.rating:0,c=n?n.text:"";let i='<div class="review-form"><div class="review-stars-input" id="rvStarPicker">';for(let s=1;s<=5;s++)i+='<span class="review-star-pick'+(s<=l?" active":"")+'" data-val="'+s+'">'+starSvgFull+"</span>";i+='</div><textarea class="review-textarea" id="rvText" placeholder="'+t("review.placeholder")+'" rows="3">'+c.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>",i+='<div class="review-form-actions"><button class="btn btn-primary review-submit-btn" id="rvSubmitBtn">'+(n?t("review.edit"):t("review.write"))+'</button><button class="btn review-cancel-btn" id="rvCancelBtn">'+t("ui.cancel")+"</button></div>",i+='<div class="review-form-error" id="rvError"></div></div>',a.innerHTML=i;let d=l;document.getElementById("rvStarPicker").querySelectorAll(".review-star-pick").forEach(s=>{s.onmouseenter=()=>{const o=parseInt(s.dataset.val);document.getElementById("rvStarPicker").querySelectorAll(".review-star-pick").forEach((u,m)=>u.classList.toggle("hover",m<o))},s.onmouseleave=()=>{document.getElementById("rvStarPicker").querySelectorAll(".review-star-pick").forEach(o=>o.classList.remove("hover"))},s.onclick=()=>{d=parseInt(s.dataset.val),document.getElementById("rvStarPicker").querySelectorAll(".review-star-pick").forEach((o,u)=>o.classList.toggle("active",u<d))}}),document.getElementById("rvCancelBtn").onclick=()=>{if(a.innerHTML="",!n){const s=document.getElementById("rvWriteBtn");s&&(s.style.display="")}},document.getElementById("rvSubmitBtn").onclick=async()=>{if(!d){document.getElementById("rvError").textContent=t("review.ratingRequired");return}const s=girls[e];s.reviews||(s.reviews=[]);const o=document.getElementById("rvText").value.trim();if(n){const u=s.reviews.find(m=>m.user===n.user);u&&(u.rating=d,u.text=o,u.ts=new Date().toISOString())}else s.reviews.push({user:loggedInUser,rating:d,text:o,ts:new Date().toISOString()});await saveData()&&(showToast(n?t("review.updated"):t("review.submitted")),renderReviews(e))};const r=document.getElementById("rvWriteBtn");r&&(r.style.display="none")}function showProfile(e){safeRender("Profile",()=>{const n=girls[e];if(!n)return;if(n.hidden&&!isAdmin()){showPage("homePage");return}currentProfileIdx=e,n.photos||(n.photos=[]),n.name&&addRecentlyViewed(n.name),_countdownInterval&&(clearInterval(_countdownInterval),_countdownInterval=null),updateOgMeta(n,e),updateProfileJsonLd(n,e);const a=n.name?"Ginza Empire â€“ "+n.name:"Ginza Empire â€“ Profile";document.title=a,Router.push(Router.pathForProfile(e),a);const l=isAdmin()?`<div class="profile-actions"><button class="btn btn-primary" id="profEdit">${t("ui.edit")}</button><button class="btn btn-danger" id="profDelete">${t("ui.delete")}</button></div>`:"",c=getAEDTDate(),i=fmtDate(c),d=getCalEntry(n.name,i),r=n.name&&isAvailableNow(n.name),s=d&&d.start&&d.end&&!r&&(()=>{const f=c.getHours()*60+c.getMinutes(),[h,b]=d.end.split(":").map(Number),[E,I]=d.start.split(":").map(Number);return h*60+b>E*60+I&&f>=h*60+b})();let o="";if(r)o='<span class="dim">|</span><span class="profile-avail-live"><span class="avail-now-dot"></span>'+t("avail.now")+" ("+fmtTime12(d.start)+" - "+fmtTime12(d.end)+")</span>";else if(d&&d.start&&d.end&&!s)o='<span class="dim">|</span><span style="color:#ffcc44;font-weight:600">'+t("avail.laterToday")+" ("+fmtTime12(d.start)+" - "+fmtTime12(d.end)+")</span>";else{const h=getWeekDates().find(b=>b>i&&(getCalEntry(n.name,b)||{}).start);if(h){const b=dispDate(h).day,E=getCalEntry(n.name,h),I=E&&E.start&&E.end?" ("+fmtTime12(E.start)+" - "+fmtTime12(E.end)+")":"",H=L=>{const S=Math.floor(L/1440),C=Math.floor(L%1440/60),T=L%60;return S>0?`${S}d ${C}h`:C>0?`${C}h ${T}m`:`${T}m`},R=Math.round((new Date(h+" 00:00")-new Date(i+" 00:00"))/864e5),z=c.getHours()*60+c.getMinutes(),[O,q]=(E&&E.start||"00:00").split(":").map(Number),P=R*1440+O*60+q-z,U=P>0?" Â· "+t("avail.startsIn").replace("{t}",H(P)):"";o='<span class="dim">|</span><span class="profile-avail-coming">'+t("avail.coming")+" "+b+I+U+"</span>"}else{const b=getLastRostered(n.name);if(b){const E=Math.round((new Date(i+" 00:00")-new Date(b+" 00:00"))/864e5),I=E===0?"today":E===1?"yesterday":E+" days ago";o='<span class="dim">|</span><span class="profile-avail-last">'+t("avail.lastSeen")+" "+I+"</span>"}}}const u=n.name?getAvailCountdown(n.name):null;if(u){const f=u.type==="ends"?"avail.endsIn":"avail.startsIn";o+='<span class="dim"> Â· </span><span id="profCountdown">'+t(f).replace("{t}",u.str)+"</span>"}const m=n.reviews||[],p=m.length?m.reduce((f,h)=>f+h.rating,0)/m.length:0,g=m.length?'<span class="dim">|</span><span class="profile-rating-summary">'+renderStarsStatic(Math.round(p))+'<span class="profile-rating-num">'+p.toFixed(1)+' / 5</span><span class="profile-rating-count">('+m.length+")</span></span>":"",v=[{l:t("field.age"),v:n.age},{l:t("field.body"),v:n.body},{l:t("field.height"),v:n.height+" cm"},{l:t("field.cup"),v:n.cup},{l:t("field.rates30"),v:n.val1||"â€”"},{l:t("field.rates45"),v:n.val2||"â€”"},{l:t("field.rates60"),v:n.val3||"â€”"},{l:t("field.experience"),v:n.exp||"â€”"}],y=n.photos.length?`<img src="${n.photos[0]}" alt="${(n.name||"").replace(/"/g,"&quot;")}">`:'<div class="silhouette"></div>',w=n.photos.length>1?'<button class="gallery-main-arrow prev" id="galPrev"><svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></button><button class="gallery-main-arrow next" id="galNext"><svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></button>':"",N=n.photos.length?`<div class="gallery-counter" id="galCounter"><span>1</span> / ${n.photos.length}</div>`:"",$=n.photos.length?'<div class="gallery-zoom-hint">Click to expand</div>':"",x=n.name&&isFavorite(n.name),D=n.name&&loggedIn?`<button class="profile-fav-btn${x?" active":""}" id="profFavBtn">${favHeartSvg(x)}${x?t("ui.favorited"):t("ui.addFav")}</button>`:"",F=n.name?`<button class="profile-share-btn" id="profShareBtn"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>${t("ui.share")}</button>`:"",A={listPage:t("page.girls"),rosterPage:t("page.roster"),homePage:t("nav.home"),favoritesPage:t("page.favorites")}[profileReturnPage]||t("ui.back");document.getElementById("profileContent").innerHTML=`<button class="back-btn" id="backBtn"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>${A}</button>
<div class="profile-nav-rail" id="profileNavRail"></div>
<div class="profile-layout"><div class="profile-image-area"><div class="gallery-main" id="galMain">${y}${w}${N}${$}</div><div class="gallery-thumbs" id="galThumbs"></div></div>
<div class="profile-details"><div class="profile-name">${n.name}</div><div class="profile-meta"><span>${Array.isArray(n.country)?n.country.join(", "):n.country}</span>${n.special?'<span class="profile-special">'+n.special+"</span>":""}${o}${g}</div><div class="profile-action-row">${D}${F}</div><div class="profile-divider" style="margin-top:24px"></div>
<div class="profile-stats">${v.map(f=>`<div class="profile-stat"><div class="p-label">${f.l}</div><div class="p-val">${f.v}</div></div>`).join("")}</div>
<div class="profile-desc-title">${t("field.special")}</div><div class="profile-desc" id="profSpecialText" style="margin-bottom:24px">${n.special||"â€”"}</div>
<div class="profile-desc-title">${t("field.language")}</div><div class="profile-desc" id="profLangText" style="margin-bottom:24px">${n.lang||"â€”"}</div>
<div class="profile-desc-title">${t("field.type")}</div><div class="profile-desc" id="profTypeText" style="margin-bottom:24px">${n.type||"â€”"}</div>
<div class="profile-desc-title">${t("field.description")}</div><div class="profile-desc" id="profDescText">${n.desc||""}</div>
${(()=>{const f=n.labels||[];return f.length?`<div class="profile-desc-title" style="margin-top:24px">${t("field.labels")}</div><div class="profile-labels">${f.slice().sort().map(h=>`<span class="profile-label">${h}</span>`).join("")}</div>`:""})()}${l}<div id="profileReviews"></div></div></div>`,document.getElementById("backBtn").onclick=()=>{const f=_savedScrollY||parseFloat(sessionStorage.getItem("ginza_scroll")||"0");showPage(profileReturnPage),requestAnimationFrame(()=>window.scrollTo(0,f))},u&&(_countdownInterval=setInterval(()=>{const f=document.getElementById("profCountdown");if(!f){clearInterval(_countdownInterval);return}const h=getAvailCountdown(n.name);h?f.textContent=t(h.type==="ends"?"avail.endsIn":"avail.startsIn").replace("{t}",h.str):(f.textContent="",clearInterval(_countdownInterval))},3e4)),isAdmin()&&(document.getElementById("profEdit").onclick=()=>openForm(e),document.getElementById("profDelete").onclick=()=>openDelete(e));const B=document.getElementById("profFavBtn");B&&(B.onclick=()=>{const f=toggleFavorite(n.name);B.classList.toggle("active",f),B.innerHTML=favHeartSvg(f)+(f?t("ui.favorited"):t("ui.addFav")),updateFavBadge()});const k=document.getElementById("profShareBtn");k&&(k.onclick=async()=>{const f=window.location.origin+Router.pathForProfile(e);if(navigator.share)try{await navigator.share({title:n.name+" - Ginza",text:n.name+" at Ginza Sydney",url:f})}catch{}else try{await navigator.clipboard.writeText(f),showToast(t("ui.linkCopied"))}catch{const b=document.createElement("input");b.value=f,document.body.appendChild(b),b.select(),document.execCommand("copy"),document.body.removeChild(b),showToast(t("ui.linkCopied"))}}),renderGallery(e),renderReviews(e),renderAlsoAvailable(e),renderSimilarGirls(e),renderProfileNav(e),closeFilterPanel(),_activeFilterPaneId="profileFilterPane",renderFilterPane("profileFilterPane"),allPages.forEach(f=>f.classList.remove("active")),document.getElementById("profilePage").classList.add("active"),document.querySelectorAll(".nav-dropdown a").forEach(f=>f.classList.remove("active")),updateFilterToggle(),window.scrollTo(0,0)})}let galIdx=0;function galGoTo(e,n){const a=document.getElementById("galMain");if(!a)return;const l=a.querySelector("img");l&&(l.classList.add("gallery-fade-out"),setTimeout(()=>{galIdx=e,l.src=n[e],l.onload=()=>l.classList.remove("gallery-fade-out");const c=document.getElementById("galCounter");c&&(c.innerHTML=`<span>${e+1}</span> / ${n.length}`);const i=document.getElementById("galThumbs");if(i){i.querySelectorAll(".gallery-thumb").forEach((r,s)=>r.classList.toggle("active",s===e));const d=i.querySelector(".gallery-thumb.active");d&&d.scrollIntoView({inline:"center",block:"nearest",behavior:"smooth"})}},180))}function renderGallery(e){const n=girls[e];if(!n||!n.photos)return;galIdx=0;const a=document.getElementById("galMain");let l=!1;if(a&&n.photos.length>1){let r=0,s=0;a.addEventListener("touchstart",o=>{r=o.touches[0].clientX,s=o.touches[0].clientY,l=!1},{passive:!0}),a.addEventListener("touchmove",o=>{Math.abs(o.touches[0].clientX-r)>8&&(l=!0)},{passive:!0}),a.addEventListener("touchend",o=>{const u=o.changedTouches[0].clientX-r,m=o.changedTouches[0].clientY-s;Math.abs(u)>45&&Math.abs(u)>Math.abs(m)&&(u<0?galGoTo((galIdx+1)%n.photos.length,n.photos):galGoTo((galIdx-1+n.photos.length)%n.photos.length,n.photos))},{passive:!0})}a&&n.photos.length&&(a.onclick=r=>{if(!r.target.closest(".gallery-main-arrow")){if(l){l=!1;return}openLightbox(n.photos,galIdx,n.name)}});const c=document.getElementById("galPrev"),i=document.getElementById("galNext");c&&(c.onclick=r=>{r.stopPropagation(),galGoTo((galIdx-1+n.photos.length)%n.photos.length,n.photos)}),i&&(i.onclick=r=>{r.stopPropagation(),galGoTo((galIdx+1)%n.photos.length,n.photos)});const d=document.getElementById("galThumbs");d&&(d.innerHTML="",n.photos.forEach((r,s)=>{const o=document.createElement("div");if(o.className="gallery-thumb"+(s===0?" active":""),o.innerHTML=`<img src="${r}" alt="${(n.name||"").replace(/"/g,"&quot;")}">`,o.onclick=()=>galGoTo(s,n.photos),isAdmin()){const u=document.createElement("button");u.className="gallery-thumb-remove",u.innerHTML="&#x2715;",u.onclick=async m=>{m.stopPropagation(),r.includes("githubusercontent.com")&&await deleteFromGithub(r),n.photos.splice(s,1),await saveData(),showProfile(e),renderGrid(),renderRoster(),renderHome(),showToast("Photo removed")},o.appendChild(u)}d.appendChild(o)}))}function openMyProfile(){const e=document.getElementById("myProfileOverlay"),n=CRED.find(l=>l.user===loggedInUser);if(!n)return;const a=loggedInRole==="owner"?'<span class="mp-role-badge owner">OWNER</span>':loggedInRole==="admin"?'<span class="mp-role-badge admin">ADMIN</span>':'<span class="mp-role-badge member">MEMBER</span>';document.getElementById("mpUserDisplay").innerHTML=`<div class="mp-username">${loggedInUser.toUpperCase()}</div>${a}`,document.getElementById("mpEmail").value=n.email||"",document.getElementById("mpMobile").value=n.mobile||"",document.getElementById("mpNewPass").value="",document.getElementById("mpConfirmPass").value="",document.getElementById("mpError").textContent="",e.classList.add("open")}document.getElementById("myProfileClose").onclick=()=>document.getElementById("myProfileOverlay").classList.remove("open"),document.getElementById("myProfileCancel").onclick=()=>document.getElementById("myProfileOverlay").classList.remove("open"),document.getElementById("myProfileOverlay").onclick=e=>{e.target.id==="myProfileOverlay"&&e.target.classList.remove("open")},document.getElementById("myProfileSave").onclick=async()=>{const e=CRED.find(d=>d.user===loggedInUser);if(!e)return;const n=document.getElementById("mpNewPass").value,a=document.getElementById("mpConfirmPass").value,l=document.getElementById("mpError");if(!document.getElementById("mpEmail").value.trim()){l.textContent=t("ui.emailRequired");return}if(n&&n!==a){l.textContent=t("ui.passwordMismatch");return}l.textContent="";const i=document.getElementById("myProfileSave");i.textContent="SAVING...",i.style.pointerEvents="none";try{e.email=document.getElementById("mpEmail").value.trim()||void 0,e.mobile=document.getElementById("mpMobile").value.trim()||void 0,n&&(e.pass=n),loggedInEmail=e.email||null,loggedInMobile=e.mobile||null,await saveAuth()&&(document.getElementById("myProfileOverlay").classList.remove("open"),showToast(t("ui.profileSaved")))}catch(d){l.textContent="Error: "+d.message}finally{i.textContent=t("form.save"),i.style.pointerEvents="auto"}};const loginIconBtn=document.getElementById("loginIconBtn"),userDropdown=document.getElementById("userDropdown"),authOverlay=document.getElementById("authOverlay"),authContent=document.getElementById("authContent");document.getElementById("authClose").onclick=()=>authOverlay.classList.remove("open"),authOverlay.onclick=e=>{e.target===authOverlay&&authOverlay.classList.remove("open")};function renderDropdown(){loggedIn?(loginIconBtn.classList.add("logged-in"),userDropdown.innerHTML=`<div class="dropdown-header"><div class="label">Signed in as</div><div class="user">${(loggedInUser||"ADMIN").toUpperCase()}</div></div><button class="dropdown-item" id="myProfileBtn">${t("ui.myProfile")}</button><button class="dropdown-item danger" id="logoutBtn">Sign Out</button>`,document.getElementById("myProfileBtn").onclick=()=>{userDropdown.classList.remove("open"),openMyProfile()},document.getElementById("logoutBtn").onclick=()=>{loggedIn=!1,loggedInUser=null,loggedInRole=null,loggedInEmail=null,loggedInMobile=null,loginIconBtn.classList.remove("logged-in"),userDropdown.classList.remove("open"),document.getElementById("navFavorites").style.display="none",document.getElementById("bnFavorites").style.display="none",document.getElementById("navCalendar").style.display="none",document.getElementById("navAnalytics").style.display="none",document.getElementById("navProfileDb").style.display="none",document.querySelectorAll(".page-edit-btn").forEach(e=>e.style.display="none"),(document.getElementById("favoritesPage").classList.contains("active")||document.getElementById("calendarPage").classList.contains("active")||document.getElementById("analyticsPage").classList.contains("active")||document.getElementById("profileDbPage").classList.contains("active"))&&showPage("homePage"),renderDropdown(),renderFilters(),renderGrid(),renderRoster(),renderHome()}):(loginIconBtn.classList.remove("logged-in"),userDropdown.innerHTML="")}function showAuthSignIn(){authContent.innerHTML=`<div class="form-title">${t("ui.signIn")}</div><div class="form-row full"><div class="form-group"><label class="form-label">Username</label><input class="form-input" id="lfUser" placeholder="Username" autocomplete="off"></div></div><div class="form-row full"><div class="form-group"><label class="form-label">Password</label><input class="form-input" id="lfPass" type="password" placeholder="Password"></div></div><div class="form-actions" style="justify-content:center"><button class="btn btn-primary" id="lfBtn" style="width:100%">${t("ui.signIn")}</button></div><div class="lf-error" id="lfError"></div><div class="lf-switch">${t("ui.noAccount")} <a href="#" id="lfSignUpLink">${t("ui.signUp")}</a></div>`,document.getElementById("lfBtn").onclick=doLogin,document.getElementById("lfPass").addEventListener("keydown",e=>{e.key==="Enter"&&doLogin()}),document.getElementById("lfUser").addEventListener("keydown",e=>{e.key==="Enter"&&document.getElementById("lfPass").focus()}),document.getElementById("lfSignUpLink").onclick=e=>{e.preventDefault(),showAuthSignUp()},authOverlay.classList.add("open")}function showAuthSignUp(){authContent.innerHTML=`<div class="form-title">${t("ui.signUp")}</div><div class="form-row full"><div class="form-group"><label class="form-label">Username *</label><input class="form-input" id="suUser" placeholder="Username" autocomplete="off"></div></div><div class="form-row full"><div class="form-group"><label class="form-label">${t("field.email")} *</label><input class="form-input" id="suEmail" type="email" placeholder="email@example.com"></div></div><div class="form-row full"><div class="form-group"><label class="form-label">${t("field.mobile")}</label><input class="form-input" id="suMobile" type="tel" placeholder="04XX XXX XXX"></div></div><div class="form-row full"><div class="form-group"><label class="form-label">Password *</label><input class="form-input" id="suPass" type="password" placeholder="Password"></div></div><div class="form-row full"><div class="form-group"><label class="form-label">${t("ui.confirmPassword")} *</label><input class="form-input" id="suConfirm" type="password" placeholder="Confirm"></div></div><div class="form-actions" style="justify-content:center"><button class="btn btn-primary" id="suBtn" style="width:100%">${t("ui.createAccount")}</button></div><div class="lf-error" id="suError"></div><div class="lf-switch">${t("ui.haveAccount")} <a href="#" id="suSignInLink">${t("ui.signIn")}</a></div>`,document.getElementById("suBtn").onclick=doSignUp,document.getElementById("suConfirm").addEventListener("keydown",e=>{e.key==="Enter"&&doSignUp()}),document.getElementById("suSignInLink").onclick=e=>{e.preventDefault(),showAuthSignIn()},authOverlay.classList.add("open")}async function doSignUp(){const e=document.getElementById("suUser").value.trim(),n=document.getElementById("suEmail").value.trim(),a=document.getElementById("suMobile").value.trim(),l=document.getElementById("suPass").value,c=document.getElementById("suConfirm").value,i=document.getElementById("suError");if(!e){i.textContent=t("ui.usernameRequired");return}if(CRED.some(r=>r.user.toLowerCase()===e.toLowerCase())){i.textContent=t("ui.usernameTaken");return}if(!n){i.textContent=t("ui.emailRequired");return}if(CRED.some(r=>r.email&&r.email.toLowerCase()===n.toLowerCase())){i.textContent=t("ui.emailTaken");return}if(a&&CRED.some(r=>r.mobile&&r.mobile===a)){i.textContent=t("ui.mobileTaken");return}if(!l){i.textContent=t("ui.passwordRequired");return}if(l!==c){i.textContent=t("ui.passwordMismatch");return}i.textContent="";const d=document.getElementById("suBtn");d.textContent="CREATING...",d.style.pointerEvents="none";try{const r={user:e,pass:l,role:"member",email:n,mobile:a||void 0};CRED.push(r),await saveAuth()?(loggedIn=!0,loggedInUser=r.user,loggedInRole="member",loggedInEmail=r.email,loggedInMobile=r.mobile||null,document.getElementById("navFavorites").style.display="",document.getElementById("bnFavorites").style.display="",authOverlay.classList.remove("open"),renderDropdown(),renderFilters(),renderGrid(),renderRoster(),renderHome(),showToast(t("ui.accountCreated")),updatePushToggle()):CRED.pop()}catch(r){CRED.pop(),i.textContent="Error: "+r.message}finally{d.textContent=t("ui.createAccount"),d.style.pointerEvents="auto"}}async function checkFavoriteNotifications(e){try{const n=await fetch(PROXY+"/send-notification",{method:"POST",headers:proxyHeaders(),body:JSON.stringify({username:e})});if(n.ok){const a=await n.json();a.sent&&a.matchCount>0&&showToast(a.matchCount===1?t("ui.favAvailOne"):t("ui.favAvailMany").replace("{count}",a.matchCount))}}catch{}}function doLogin(){const e=document.getElementById("lfUser").value.trim(),n=document.getElementById("lfPass").value,a=CRED.find(l=>l.user===e&&l.pass===n);a?(loggedIn=!0,loggedInUser=a.user,loggedInRole=a.role||"member",loggedInEmail=a.email||null,loggedInMobile=a.mobile||null,document.getElementById("navFavorites").style.display="",document.getElementById("bnFavorites").style.display="",isAdmin()&&(document.getElementById("navCalendar").style.display="",document.getElementById("navAnalytics").style.display="",document.querySelectorAll(".page-edit-btn").forEach(l=>l.style.display="")),authOverlay.classList.remove("open"),renderDropdown(),renderFilters(),renderGrid(),renderRoster(),renderHome(),updateFavBadge(),document.getElementById("profilePage").classList.contains("active")&&showProfile(currentProfileIdx),showToast("Signed in as "+a.user.toUpperCase()),checkFavoriteNotifications(a.user),updatePushToggle()):(document.getElementById("lfError").textContent="Invalid credentials.",document.getElementById("lfPass").value="")}loginIconBtn.onclick=e=>{e.stopPropagation(),loggedIn?userDropdown.classList.toggle("open"):showAuthSignIn()},document.addEventListener("click",e=>{!e.target.closest("#userDropdown")&&!e.target.closest("#loginIconBtn")&&userDropdown.classList.remove("open")}),renderDropdown();const _pushBtn=document.getElementById("pushToggleBtn"),_pushLabel=document.getElementById("pushToggleLabel");async function updatePushToggle(){if(!_pushBtn||!("PushManager"in window)||!loggedIn){_pushBtn&&(_pushBtn.style.display="none");return}_pushBtn.style.display="";const e=await getPushSubscription();_pushBtn.classList.toggle("active",!!e),_pushLabel.textContent=e?t("ui.pushDisable"):t("ui.pushEnable")}_pushBtn&&(_pushBtn.onclick=async()=>{_pushBtn.disabled=!0,await getPushSubscription()?(await unsubscribeFromPush(),showToast(t("ui.pushOff"))):await subscribeToPush()?showToast(t("ui.pushOn")):showToast(t("ui.pushDenied"),"error"),_pushBtn.disabled=!1,updatePushToggle()});const particlesEl=document.getElementById("particles");for(let e=0;e<30;e++){const n=document.createElement("div");n.className="particle",n.style.left=Math.random()*100+"%",n.style.animationDuration=8+Math.random()*12+"s",n.style.animationDelay=Math.random()*10+"s",n.style.width=n.style.height=1+Math.random()*2+"px",particlesEl.appendChild(n)}let _activeFilterPaneId=null;const _filterToggle=document.getElementById("filterToggle"),_filterBackdrop=document.getElementById("filterBackdrop"),_pagesWithFilters=["rosterPage","listPage","calendarPage","profilePage"];function updateFilterToggle(){const e=_pagesWithFilters.some(l=>{const c=document.getElementById(l);return c&&c.classList.contains("active")});_filterToggle.classList.toggle("visible",e);const n=countActiveFilters();_filterToggle.classList.toggle("has-filters",n>0);const a=_filterToggle.querySelector(".ft-text");a&&(a.textContent=n>0?t("ui.filtersActive").replace("{n}",n):t("ui.filters"))}function openFilterPanel(){if(!_activeFilterPaneId)return;const e=document.getElementById(_activeFilterPaneId);e&&(["rosterFilterPane","girlsFilterPane","calFilterPane","profileFilterPane"].forEach(n=>{const a=document.getElementById(n);a&&a.classList.remove("open")}),renderFilterPane(_activeFilterPaneId),e.classList.add("open"),_filterToggle.classList.add("open"),_filterBackdrop.classList.add("open"))}function closeFilterPanel(){["rosterFilterPane","girlsFilterPane","calFilterPane","profileFilterPane"].forEach(e=>{const n=document.getElementById(e);n&&n.classList.remove("open")}),_filterToggle.classList.remove("open"),_filterBackdrop.classList.remove("open")}function toggleFilterPanel(){_filterToggle.classList.contains("open")?closeFilterPanel():openFilterPanel()}_filterToggle.onclick=toggleFilterPanel,_filterBackdrop.onclick=closeFilterPanel,function(){const e=document.getElementById("backToTop");if(!e)return;const n=["rosterPage","listPage","favoritesPage","calendarPage"];window.addEventListener("scroll",()=>{n.some(l=>{const c=document.getElementById(l);return c&&c.classList.contains("active")})&&window.scrollY>300?e.classList.add("visible"):e.classList.remove("visible")}),e.onclick=()=>window.scrollTo({top:0,behavior:"smooth"})}(),function(){const e=document.getElementById("fabToggle"),n=document.getElementById("fabMenu");!e||!n||(e.onclick=()=>{e.classList.toggle("open"),n.classList.toggle("open")},document.addEventListener("click",a=>{a.target.closest(".fab-container")||(e.classList.remove("open"),n.classList.remove("open"))}))}();
