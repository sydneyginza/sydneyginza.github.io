(function(){var I=document.getElementById("formOverlay"),z=["fName","fAge","fBody","fHeight","fCup","fVal1","fVal2","fVal3","fSpecial","fExp","fStartDate","fLang","fType","fDesc"],B=[];document.getElementById("formClose").onclick=()=>I.classList.remove("open"),document.getElementById("formCancel").onclick=()=>I.classList.remove("open"),I.onclick=e=>{e.target===I&&I.classList.remove("open")};var p=[],N=[],k=[],M=[],T=[],f=null,_=["Chinese","French","Italian","Japanese","Korean","Russian","Thailand","Vietnamese","Other"];function R(){var e=document.getElementById("fCountryOptions");e.innerHTML="",_.forEach(n=>{var a=document.createElement("div");a.className="country-opt"+(T.includes(n)?" selected":""),a.textContent=n,a.onclick=()=>{T.includes(n)?T=T.filter(o=>o!==n):T.push(n),R()},e.appendChild(a)})}function C(){var e=document.getElementById("fPhotoGrid"),n=document.getElementById("fPhotoCount");if(e.innerHTML="",n.textContent=`(${p.length} / ${MAX_PHOTOS})`,p.length>1){var a=document.createElement("div");a.style.cssText='width:100%;font-family:"Rajdhani",sans-serif;font-size:11px;color:rgba(255,255,255,0.25);letter-spacing:1px;margin-bottom:6px',a.textContent="Click to select · ← → to move · Drag to reorder",e.appendChild(a)}var o=null;if(p.forEach((d,i)=>{var c=document.createElement("div");c.style.cssText="position:relative;display:inline-block;cursor:grab",c.draggable=!0;var s=document.createElement("div");s.style.cssText="width:64px;height:64px;border:2px solid rgba(255,255,255,0.1);overflow:hidden;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,6px 100%,0 calc(100% - 6px));transition:border-color .15s",f===i&&(s.style.borderColor="var(--accent)"),s.innerHTML=`<img src="${d}" style="width:100%;height:100%;object-fit:cover;pointer-events:none">`,c.onclick=r=>{r.target===u||u.contains(r.target)||(f=f===i?null:i,C())};var u=document.createElement("button");u.style.cssText="position:absolute;top:1px;right:1px;width:18px;height:18px;background:rgba(0,0,0,0.85);border:1px solid rgba(255,68,68,0.5);color:#ff4444;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:2px;z-index:2",u.innerHTML="&#x2715;",u.onclick=r=>{r.stopPropagation(),f===i?f=null:f>i&&f--;var m=p[i];if(m.startsWith("data:")){var y=k.indexOf(m);y>=0&&(k.splice(y,1),M.splice(y,1))}N.push(m),p.splice(i,1),C()},c.ondragstart=r=>{o=i,r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",String(i)),setTimeout(()=>{c.style.opacity="0.35"},0)},c.ondragend=()=>{c.style.opacity="",o=null,e.querySelectorAll("div[draggable]").forEach(r=>{var m=r.querySelector("div");m&&(m.style.borderColor="rgba(255,255,255,0.1)")})},c.ondragover=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move",o!==null&&o!==i&&(s.style.borderColor="var(--accent)")},c.ondragleave=()=>{s.style.borderColor="rgba(255,255,255,0.1)"},c.ondrop=r=>{r.preventDefault(),s.style.borderColor="rgba(255,255,255,0.1)";var m=parseInt(r.dataTransfer.getData("text/plain")),y=i;if(!(m===y||isNaN(m))){var h=p.splice(m,1)[0];p.splice(y,0,h),C()}},c.appendChild(s),c.appendChild(u),e.appendChild(c)}),p.length<MAX_PHOTOS){var l=document.createElement("div");l.style.cssText="width:64px;height:64px;border:2px dashed rgba(180,74,255,0.3);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--accent);font-size:22px;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,6px 100%,0 calc(100% - 6px));transition:all .3s",l.innerHTML="+",l.onmouseenter=()=>{l.style.borderColor="var(--accent)",l.style.background="rgba(180,74,255,0.06)"},l.onmouseleave=()=>{l.style.borderColor="rgba(180,74,255,0.3)",l.style.background="none"},l.onclick=()=>{var d=MAX_PHOTOS-p.length;if(!(d<=0)){var i=document.createElement("input");i.type="file",i.accept="image/*",i.multiple=!0,i.onchange=c=>{var s=Array.from(c.target.files).slice(0,d),u=0;s.forEach(r=>{var m=new FileReader;m.onload=y=>{p.push(y.target.result),k.push(y.target.result),M.push(r.name),u++,u===s.length&&C()},m.readAsDataURL(r)})},i.click()}},e.appendChild(l)}}function O(){var e=document.getElementById("fLabelTags");e.innerHTML="",B.forEach((n,a)=>{var o=document.createElement("span");o.className="label-tag",o.innerHTML=`${n}<button class="label-remove" title="Remove">&times;</button>`,o.querySelector(".label-remove").onclick=()=>{B.splice(a,1),O()},e.appendChild(o)})}var S=document.getElementById("fLabelInput");S&&S.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();var n=sanitize(S.value);n&&!B.includes(n)&&(B.push(n),O()),S.value=""}}),document.addEventListener("keydown",e=>{if(I.classList.contains("open")&&f!==null&&!(document.activeElement&&document.activeElement.matches("input,textarea,select"))){if(e.key==="ArrowLeft"&&f>0){e.preventDefault();var n=p.splice(f,1)[0];f--,p.splice(f,0,n),C()}else if(e.key==="ArrowRight"&&f<p.length-1){e.preventDefault();var n=p.splice(f,1)[0];f++,p.splice(f,0,n),C()}}}),window.openForm=function(e){if(typeof e>"u"&&(e=-1),document.getElementById("editIndex").value=e,N=[],k=[],M=[],f=null,e>=0){document.getElementById("formTitle").textContent=t("form.editGirl");var n=girls[e];document.getElementById("fName").value=n.name;var a=n.country||"";T=Array.isArray(a)?[...a]:a?[a]:[],document.getElementById("fAge").value=n.age,document.getElementById("fBody").value=n.body,document.getElementById("fHeight").value=n.height,document.getElementById("fCup").value=n.cup,document.getElementById("fVal1").value=n.val1||"",document.getElementById("fVal2").value=n.val2||"",document.getElementById("fVal3").value=n.val3||"",document.getElementById("fSpecial").value=n.special||"",document.getElementById("fExp").value=n.exp||"",document.getElementById("fStartDate").value=n.startDate||fmtDate(getAEDTDate()),document.getElementById("fLang").value=n.lang||"",document.getElementById("fType").value=n.type||"",document.getElementById("fDesc").value=n.desc,p=[...n.photos||[]],B=[...n.labels||[]]}else document.getElementById("formTitle").textContent=t("form.addGirl"),z.forEach(o=>document.getElementById(o).value=""),document.getElementById("fStartDate").value=fmtDate(getAEDTDate()),p=[],B=[],T=[];C(),O(),R(),I.classList.add("open")},document.getElementById("formSave").onclick=async()=>{var e=[{id:"fName",label:"Name"},{id:"fAge",label:"Age"},{id:"fBody",label:"Body Size"},{id:"fHeight",label:"Height"},{id:"fCup",label:"Cup Size"},{id:"fExp",label:"Experience"},{id:"fVal3",label:"Value 3"},{id:"fStartDate",label:"Start Date"},{id:"fLang",label:"Language"},{id:"fType",label:"Type"},{id:"fDesc",label:"Description"}];for(var n of e){var a=document.getElementById(n.id);if(!a.value.trim()){a.focus(),showToast(n.label+" is required","error");return}}if(T.length===0){showToast("Country is required","error");return}if(p.length===0){showToast("At least one photo is required","error");return}var o=sanitize(document.getElementById("fName").value),l=document.getElementById("formSave");l.textContent="SAVING...",l.style.pointerEvents="none";try{for(var d of N)d.includes("githubusercontent.com")&&await deleteFromGithub(d);var i=[];for(var c of p)if(c.startsWith("data:"))if(GT){var s=k.indexOf(c);i.push(await uploadToGithub(c,o,s>=0?M[s]:genFn()))}else i.push(c);else i.push(c);var u=document.getElementById("fSpecial").value.trim(),r=document.getElementById("fLang").value.trim(),m=document.getElementById("fType").value.trim(),y=sanitize(document.getElementById("fDesc").value),h={name:o,location:"Empire",country:[...T],age:document.getElementById("fAge").value.trim(),body:document.getElementById("fBody").value.trim(),height:document.getElementById("fHeight").value.trim(),cup:document.getElementById("fCup").value.trim(),val1:document.getElementById("fVal1").value.trim(),val2:document.getElementById("fVal2").value.trim(),val3:document.getElementById("fVal3").value.trim(),special:u,exp:document.getElementById("fExp").value.trim(),startDate:document.getElementById("fStartDate").value.trim(),lang:r,type:m,desc:y,specialJa:u,langJa:r,typeJa:m,descJa:y,photos:i,labels:[...B],labelsJa:[...B],lastModified:new Date().toISOString()},b=parseInt(document.getElementById("editIndex").value);b>=0?girls[b]=h:girls.push(h),await saveData()&&(logAdminAction(b>=0?"profile_edit":"profile_add",o),I.classList.remove("open"),renderFilters(),renderGrid(),renderRoster(),renderHome(),document.getElementById("profilePage").classList.contains("active")&&b>=0&&showProfile(b),showToast(b>=0?"Profile updated":"Profile added"))}catch($){showToast("Error: "+$.message,"error")}finally{l.textContent="SAVE",l.style.pointerEvents="auto"}};var D=document.getElementById("deleteOverlay"),x=-1;document.getElementById("deleteCancel").onclick=()=>D.classList.remove("open"),D.onclick=e=>{e.target===D&&D.classList.remove("open")},window.openDelete=function(e){x=e,document.getElementById("deleteMsg").textContent=`Remove "${girls[e].name}" from the roster?`,D.classList.add("open")},document.getElementById("deleteConfirm").onclick=async()=>{if(x>=0){var e=girls[x];if(e.photos&&GT)for(var n of e.photos)n.includes("githubusercontent.com")&&await deleteFromGithub(n);var a=e.name;girls.splice(x,1),await saveData(),logAdminAction("profile_delete",a),x=-1,D.classList.remove("open"),renderFilters(),renderGrid(),renderRoster(),renderHome(),document.getElementById("profilePage").classList.contains("active")&&showPage("homePage"),showToast("Profile deleted")}};var H=null;function w(e){var n=document.getElementById("copyTimeModal");n.classList.remove("open"),H&&(H(e),H=null)}window.findExistingTimes=function(e,n){var a=getWeekDates();for(var o of a)if(o!==n){var l=getCalEntry(e,o);if(l&&l.start&&l.end)return{date:o,start:l.start,end:l.end}}return null},window.showCopyTimePrompt=function(e,n,a,o){return new Promise(l=>{var d=document.getElementById("copyTimeModal"),i=dispDate(n);document.getElementById("copyTimeMsg").innerHTML=`<strong style="color:#fff">${e}</strong> has existing times from <strong style="color:#fff">${i.day} ${i.date}</strong>`,document.getElementById("copyTimeDetail").textContent=fmtTime12(a)+" — "+fmtTime12(o),H=l,d.classList.add("open")})},document.getElementById("copyTimeCopy").onclick=()=>w("copy"),document.getElementById("copyTimeNew").onclick=()=>w("new"),document.getElementById("copyTimeCancel").onclick=()=>w("cancel"),document.getElementById("copyTimeModal").onclick=e=>{e.target===document.getElementById("copyTimeModal")&&w("cancel")},window.addEventListener("beforeunload",()=>w("cancel"));var E=null,v=[];function L(e){return girls.filter(n=>{if(!n.name)return!1;var a=getCalEntry(n.name,e);return a&&a.start&&a.end})}function A(){var e=getWeekDates(),n=e[0],a=document.getElementById("copyDaySources");a.innerHTML="",e.forEach(r=>{var m=dispDate(r),y=L(r).length,h=document.createElement("button");h.className="copy-day-btn"+(r===E?" active":"")+(y===0?" disabled":""),h.innerHTML=(r===n?t("ui.today"):m.day)+' <span style="opacity:.5;font-size:11px">('+y+")</span>",h.onclick=()=>{E=r,v=v.filter(b=>b!==r),A()},a.appendChild(h)});var o=document.getElementById("copyDayPreview"),l=L(E);if(l.length){var d=dispDate(E);o.innerHTML='<div class="copy-day-preview-title">'+d.day+" "+d.date+" — "+l.length+" girl"+(l.length>1?"s":"")+'</div><div class="copy-day-preview-list">'+l.map(r=>{var m=getCalEntry(r.name,E);return'<div class="copy-day-preview-item"><span class="cdp-name">'+r.name+'</span><span class="cdp-time">'+fmtTime12(m.start)+" — "+fmtTime12(m.end)+"</span></div>"}).join("")+"</div>"}else o.innerHTML='<div class="copy-day-preview-empty">'+t("cal.noScheduled")+"</div>";var i=document.getElementById("copyDayTargets");i.innerHTML="",e.forEach(r=>{if(r!==E){var m=dispDate(r),y=L(r).length,h=document.createElement("button");h.className="copy-day-btn"+(v.includes(r)?" target-active":""),h.innerHTML=(r===n?t("ui.today"):m.day)+(y>0?' <span style="opacity:.5;font-size:11px">('+y+")</span>":""),h.onclick=()=>{var b=v.indexOf(r);b>=0?v.splice(b,1):v.push(r),A()},i.appendChild(h)}});var c=e.filter(r=>r!==E);if(c.length>1){var s=document.createElement("button");s.className="copy-day-btn"+(v.length===c.length?" target-active":""),s.style.fontStyle="italic",s.textContent=t("cal.all"),s.onclick=()=>{v.length===c.length?v=[]:v=[...c],A()},i.appendChild(s)}var u=document.getElementById("copyDayApply");u.disabled=l.length===0||v.length===0,u.style.opacity=u.disabled?".4":"1",u.style.pointerEvents=u.disabled?"none":"auto"}function P(){document.getElementById("copyDayModal").classList.remove("open")}window.openCopyDayModal=function(){var e=getWeekDates();E=null,v=[];for(var n of e){var a=L(n).length;if(a>0){E=n;break}}E||(E=e[0]),A(),document.getElementById("copyDayModal").classList.add("open")},document.getElementById("copyDayCancel").onclick=P,document.getElementById("copyDayModal").onclick=e=>{e.target===document.getElementById("copyDayModal")&&P()},document.getElementById("copyDayApply").onclick=async function(){var e=L(E);if(!(!e.length||!v.length)){var n=document.getElementById("copyDayOverwrite").checked,a=0;v.forEach(o=>{e.forEach(l=>{var d=getCalEntry(l.name,E);if(!(!d||!d.start||!d.end)){var i=getCalEntry(l.name,o);i&&i.start&&i.end&&!n||(calData[l.name]||(calData[l.name]={}),calData[l.name][o]={start:d.start,end:d.end},a++)}})}),a>0?(this.textContent="Saving...",this.style.pointerEvents="none",await saveCalData(),this.textContent=t("cal.copyDayBtn"),this.style.pointerEvents="auto",renderCalendar(),renderRoster(),renderGrid(),renderHome(),showToast("Copied "+e.length+" schedule"+(e.length>1?"s":"")+" to "+v.length+" day"+(v.length>1?"s":""))):showToast("Nothing to copy (all targets already have entries)","error"),P()}};var F="",g=[];function V(){var e=getWeekDates(),n=e[0],a=document.getElementById("bulkTimeDays");a.innerHTML="",e.forEach(d=>{var i=dispDate(d),c=getCalEntry(F,d),s=document.createElement("button");s.className="copy-day-btn"+(g.includes(d)?" target-active":""),s.innerHTML=(d===n?t("ui.today"):i.day)+(c&&c.start?' <span style="opacity:.4;font-size:10px">✓</span>':""),s.onclick=()=>{var u=g.indexOf(d);u>=0?g.splice(u,1):g.push(d),V()},a.appendChild(s)});var o=document.createElement("button");o.className="copy-day-btn"+(g.length===e.length?" target-active":""),o.style.fontStyle="italic",o.textContent=t("cal.all"),o.onclick=()=>{g.length===e.length?g=[]:g=[...e],V()},a.appendChild(o);var l=document.getElementById("bulkTimeApply");l.disabled=g.length===0,l.style.opacity=l.disabled?".4":"1",l.style.pointerEvents=l.disabled?"none":"auto"}function G(){document.getElementById("bulkTimeModal").classList.remove("open")}window.openBulkTimeModal=function(e){F=e;var n=getWeekDates();g=n.filter(c=>{var s=getCalEntry(e,c);return!s||!s.start||!s.end}),g.length||(g=[...n]);var a="",o="";for(var l of n){var d=getCalEntry(e,l);if(d&&d.start&&d.end){a=d.start,o=d.end;break}}document.getElementById("bulkTimeName").textContent=e;var i=generateTimeOptions();document.getElementById("bulkTimeStart").innerHTML=i,document.getElementById("bulkTimeEnd").innerHTML=i,a&&(document.getElementById("bulkTimeStart").value=a),o&&(document.getElementById("bulkTimeEnd").value=o),V(),document.getElementById("bulkTimeModal").classList.add("open")},document.getElementById("bulkTimeCancel").onclick=G,document.getElementById("bulkTimeModal").onclick=e=>{e.target===document.getElementById("bulkTimeModal")&&G()},document.getElementById("bulkTimeApply").onclick=async function(){var e=document.getElementById("bulkTimeStart").value,n=document.getElementById("bulkTimeEnd").value;if(!e||!n){showToast("Please set both start and end times","error");return}var a=F;calData[a]||(calData[a]={}),g.forEach(o=>{calData[a][o]={start:e,end:n},calPending[a]&&delete calPending[a][o]}),this.textContent="Saving...",this.style.pointerEvents="none",await saveCalData(),this.textContent=t("cal.apply"),this.style.pointerEvents="auto",renderCalendar(),renderRoster(),renderGrid(),renderHome(),showToast(a+" marked available for "+g.length+" day"+(g.length>1?"s":"")),G()},window._adminLoaded=!0})();
