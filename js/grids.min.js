let rosterAvailFilter=null;function renderFilters(){const l=document.getElementById("filterBar");l.innerHTML="";const o=document.createElement("div");o.className="filter-sep",l.appendChild(o),[{key:"name",label:t("sort.name")},{key:"newest",label:t("sort.dateAdded")},{key:"age",label:t("sort.age")},{key:"body",label:t("sort.size")},{key:"height",label:t("sort.height")},{key:"cup",label:t("sort.cup")},{key:"lastSeen",label:t("sort.lastSeen")}].forEach(r=>{const a=document.createElement("button");a.className="sort-btn"+(gridSort===r.key?" active":""),a.textContent=r.label,a.onclick=()=>{gridSort===r.key?gridSortDir=gridSortDir==="asc"?"desc":"asc":(gridSort=r.key,gridSortDir=r.key==="newest"||r.key==="lastSeen"?"desc":"asc"),_persistSort(),renderFilters(),renderGrid(),renderRoster(),renderFavoritesGrid(),pushFiltersToURL()},l.appendChild(a)});const e=document.createElement("button");if(e.className="sort-dir-btn",e.title=gridSortDir==="asc"?"Ascending":"Descending",e.innerHTML=gridSortDir==="asc"?'<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg><span class="sort-dir-label">ASC</span>':'<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg><span class="sort-dir-label">DESC</span>',e.onclick=()=>{gridSortDir=gridSortDir==="asc"?"desc":"asc",_persistSort(),renderFilters(),renderGrid(),renderRoster(),renderFavoritesGrid(),pushFiltersToURL()},l.appendChild(e),hasActiveFilters()){const r=document.createElement("div");r.className="filter-sep",l.appendChild(r);const a=document.createElement("button");a.className="filter-btn clear-filters-btn",a.innerHTML="&#10005; Clear",a.onclick=()=>{clearAllFilters(),onFiltersChanged()},l.appendChild(a)}if(isAdmin()){const r=document.createElement("button");r.className="add-btn",r.innerHTML="+ "+t("ui.addGirl"),r.onclick=()=>openForm(),l.appendChild(r)}}function renderAvailNowBar(){const l=document.getElementById("rosterAvailBar");if(!l)return;const o=fmtDate(getAEDTDate());if(rosterDateFilter!==o){rosterAvailFilter=null,l.innerHTML="",l.style.display="none";return}const c=getAEDTDate(),e=c.getHours()*60+c.getMinutes(),r=girls.filter(n=>{const i=getCalEntry(n.name,o);return i&&i.start&&i.end});let a=0,d=0,s=0;if(r.forEach(n=>{const i=getCalEntry(n.name,o),[m,p]=i.start.split(":").map(Number),[v,h]=i.end.split(":").map(Number),y=m*60+p,C=v*60+h;(C<=y?e>=y||e<C:e>=y&&e<C)?a++:C>y&&e>=C?s++:d++}),l.innerHTML="",!a&&!d&&!s){l.style.display="none";return}if(l.style.display="",a>0){const n=document.createElement("button");n.className="avail-now-pill"+(rosterAvailFilter==="now"?" active":"");const i=a===1&&siteLanguage==="en"?"1 girl available now":t("ui.girlsAvailNow").replace("{n}",a);n.innerHTML=`<span class="avail-now-dot"></span>${i}`,n.onclick=()=>{rosterAvailFilter=rosterAvailFilter==="now"?null:"now",renderAvailNowBar(),renderRosterGrid()},l.appendChild(n)}if(d>0){const n=document.createElement("button");n.className="avail-today-pill"+(rosterAvailFilter==="later"?" active":"");const i=d===1&&siteLanguage==="en"?"1 girl available later today":t("ui.girlsAvailLater").replace("{n}",d);n.innerHTML=`<span class="avail-today-dot"></span>${i}`,n.onclick=()=>{rosterAvailFilter=rosterAvailFilter==="later"?null:"later",renderAvailNowBar(),renderRosterGrid()},l.appendChild(n)}if(s>0){const n=document.createElement("button");n.className="avail-finished-pill"+(rosterAvailFilter==="finished"?" active":""),n.textContent=s+(s===1?" girl ":" girls ")+t("avail.finished").toLowerCase(),n.onclick=()=>{rosterAvailFilter=rosterAvailFilter==="finished"?null:"finished",renderAvailNowBar(),renderRosterGrid()},l.appendChild(n)}}function applySortOrder(l){const o=gridSortDir==="desc"?-1:1,c=(e,r,a)=>{const d=(e.name||"").trim(),s=(r.name||"").trim();return!d&&!s?0:d?s?a(e,r)*o:-1:1};return gridSort==="age"?l.sort((e,r)=>c(e,r,()=>{const a=parseFloat(e.age)||999,d=parseFloat(r.age)||999;return a-d})):gridSort==="newest"?l.sort((e,r)=>c(e,r,()=>{const a=e.startDate||"",d=r.startDate||"";return!a&&!d?0:a?d?d.localeCompare(a):-1:1})):gridSort==="body"?l.sort((e,r)=>c(e,r,()=>{const a=parseFloat(e.body)||999,d=parseFloat(r.body)||999;return a-d})):gridSort==="height"?l.sort((e,r)=>c(e,r,()=>{const a=parseFloat(e.height)||999,d=parseFloat(r.height)||999;return a-d})):gridSort==="cup"?l.sort((e,r)=>c(e,r,()=>(e.cup||"").toLowerCase().localeCompare((r.cup||"").toLowerCase()))):gridSort==="lastSeen"?l.sort((e,r)=>c(e,r,()=>{const a=getLastRostered(e.name)||"",d=getLastRostered(r.name)||"";return!a&&!d?0:a?d?d.localeCompare(a):-1:1})):l.sort((e,r)=>c(e,r,()=>(e.name||"").trim().toLowerCase().localeCompare((r.name||"").trim().toLowerCase())))}function daysAgo(l){const o=Math.floor((Date.now()-new Date(l))/864e5);return o===0?"Today":o===1?"Yesterday":o+" days ago"}const grid=document.getElementById("girlsGrid");function cardFavBtn(l){if(!loggedIn)return"";const o=l&&isFavorite(l);return`<button class="card-fav${o?" active":""}" data-fav-name="${l||""}" title="${o?"Remove from favorites":"Add to favorites"}">${favHeartSvg(o)}</button>`}function bindCardFavs(l){l.querySelectorAll(".card-fav").forEach(o=>{o.onclick=c=>{c.stopPropagation();const e=o.dataset.favName;if(!e)return;const r=toggleFavorite(e);o.classList.toggle("active",r),o.innerHTML=favHeartSvg(r),o.title=r?"Remove from favorites":"Add to favorites",o.classList.remove("fav-pop"),o.offsetWidth,o.classList.add("fav-pop"),updateFavBadge()}})}function cardRatingHtml(l){const o=l.reviews||[];if(!o.length)return"";const c=o.reduce((e,r)=>e+r.rating,0)/o.length;return'<div class="card-rating">'+renderStarsStatic(Math.round(c))+'<span class="card-rating-num">'+c.toFixed(1)+'</span><span class="card-rating-count">('+o.length+")</span></div>"}function cardCompareBtn(l){if(!l)return"";const o=isCompareSelected(l),c=compareSelected.length;return`<button class="card-compare${o?" active":""}" data-compare-name="${l}" title="${o?"Remove from compare":"Add to compare"}"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M9 3H3.5A1.5 1.5 0 002 4.5V9a1.5 1.5 0 001.5 1.5H9A1.5 1.5 0 0010.5 9V4.5A1.5 1.5 0 009 3zm11 0h-5.5A1.5 1.5 0 0013 4.5V9a1.5 1.5 0 001.5 1.5H20A1.5 1.5 0 0021.5 9V4.5A1.5 1.5 0 0020 3zM9 13.5H3.5A1.5 1.5 0 002 15v4.5A1.5 1.5 0 003.5 21H9a1.5 1.5 0 001.5-1.5V15A1.5 1.5 0 009 13.5zm11 0h-5.5A1.5 1.5 0 0013 15v4.5a1.5 1.5 0 001.5 1.5H20a1.5 1.5 0 001.5-1.5V15a1.5 1.5 0 00-1.5-1.5z"/></svg><span class="compare-badge" style="${o&&c>0?"":"display:none"}">${c}/${COMPARE_MAX}</span></button>`}function bindCardCompare(l){l.querySelectorAll(".card-compare").forEach(o=>{o.onclick=c=>{c.stopPropagation();const e=o.dataset.compareName;if(!e)return;const r=isCompareSelected(e);if(toggleCompare(e)!==!1){const d=r?"compare-shrink":"compare-pop";if(o.classList.remove("compare-pop","compare-shrink"),o.offsetWidth,o.classList.add(d),!r){const s=o.closest(".girl-card");s&&(s.classList.remove("compare-highlight"),s.offsetWidth,s.classList.add("compare-highlight"),setTimeout(()=>s.classList.remove("compare-highlight"),700))}}}})}function renderGrid(){safeRender("Girls Grid",()=>{let l=[...girls];isAdmin()||(l=l.filter(e=>!e.hidden)),l=applySharedFilters(l),loggedIn||(l=l.filter(e=>e.name&&String(e.name).trim().length>0)),applySortOrder(l),grid.innerHTML="";const o=fmtDate(getAEDTDate());let c;if(!l.length&&hasActiveFilters()){grid.innerHTML=`<div class="fav-empty"><div class="fav-empty-icon" style="opacity:.15">&#x1F50D;</div><div class="fav-empty-text">${t("ui.noResults")}</div><button class="empty-state-cta" onclick="clearAllFilters();onFiltersChanged()">${t("ui.clearFilters")}</button></div>`;return}l.forEach((e,r)=>{const a=safeCardRender(e,r,()=>{const d=girls.indexOf(e),s=document.createElement("div");s.className="girl-card"+(e.hidden?" card-hidden":"");const n=e.hidden?"&#x1F441;":"&#x1F6AB;",i=e.hidden?t("ui.showGirl"):t("ui.hideGirl"),m=isAdmin()?`<div class="card-actions"><button class="card-action-btn hide-toggle${e.hidden?" active":""}" title="${i}" data-idx="${d}">${n}</button><button class="card-action-btn edit" title="Edit" data-idx="${d}">&#x270E;</button><button class="card-action-btn delete" title="Delete" data-idx="${d}">&#x2715;</button></div>`:"",p=e.photos&&e.photos.length?lazyThumb(e.photos[0],"card-thumb",e.name):'<div class="silhouette"></div>',v=getCalEntry(e.name,o),h=e.name&&isAvailableNow(e.name),y=getAEDTDate(),C=v&&v.start&&v.end&&!h&&(()=>{const f=y.getHours()*60+y.getMinutes(),[u,b]=v.end.split(":").map(Number),[w,L]=v.start.split(":").map(Number);return u*60+b>w*60+L&&f>=u*60+b})(),$=e.name?getAvailCountdown(e.name):null,E=$?' <span style="opacity:.65;font-size:.85em">·</span> '+($.type==="ends"?t("avail.endsIn"):t("avail.startsIn")).replace("{t}",$.str):"",S=h?`<div class="card-avail card-avail-live"><span class="avail-now-dot"></span><span>${t("avail.now")} (${fmtTime12(v.start)} - ${fmtTime12(v.end)})${E}</span></div>`:!C&&v&&v.start&&v.end?`<div class="card-avail">${t("avail.laterToday")} (${fmtTime12(v.start)} - ${fmtTime12(v.end)})${E}</div>`:"";let D="";if(!S&&e.name){const u=getWeekDates().find(b=>b>o&&(getCalEntry(e.name,b)||{}).start);if(u){const b=dispDate(u).day,w=getCalEntry(e.name,u),L=w&&w.start&&w.end?` (${fmtTime12(w.start)} - ${fmtTime12(w.end)})`:"",k=x=>{const F=Math.floor(x/1440),H=Math.floor(x%1440/60),N=x%60;return F>0?`${F}d ${H}h`:H>0?`${H}h ${N}m`:`${N}m`},A=Math.round((new Date(u+" 00:00")-new Date(o+" 00:00"))/864e5),M=y.getHours()*60+y.getMinutes(),[B,q]=(w&&w.start||"00:00").split(":").map(Number),P=A*1440+B*60+q-M,I=P>0?' <span style="opacity:.65;font-size:.85em">·</span> '+t("avail.startsIn").replace("{t}",k(P)):"";D=`<div class="card-coming">${t("avail.coming")} ${b}${L}${I}</div>`}else{const b=getLastRostered(e.name);if(b){const w=Math.round((new Date(o+" 00:00")-new Date(b+" 00:00"))/864e5),L=w===0?"today":w===1?"yesterday":w+" days ago";D=`<div class="card-last-seen">${t("avail.lastSeen")} ${L}</div>`}}}const T=e.name?cardFavBtn(e.name):"",g=e.name?cardCompareBtn(e.name):"";return s.innerHTML=`<div class="card-img" style="background:linear-gradient(135deg,rgba(180,74,255,0.06),rgba(255,111,0,0.03))">${p}${T}${g}${m}</div><div class="card-info"><div class="card-name">${e.name||""}</div><div class="card-country">${Array.isArray(e.country)?e.country.join(", "):e.country||""}</div>${e.special?'<div class="card-special">'+e.special+"</div>":""}${cardRatingHtml(e)}${S||D}${isAdmin()&&e.lastModified?`<div style="font-size:10px;color:rgba(255,255,255,0.28);letter-spacing:1px;margin-top:2px">${daysAgo(e.lastModified)}</div>`:""}<div class="card-hover-line"></div></div>`,s.onclick=f=>{f.target.closest(".card-action-btn")||f.target.closest(".card-fav")||f.target.closest(".card-compare")||(_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage="listPage",showProfile(d))},isAdmin()&&(s.querySelector(".hide-toggle").onclick=async f=>{f.stopPropagation(),e.hidden=!e.hidden,await saveData()&&(renderGrid(),renderRoster(),renderHome(),showToast(e.hidden?t("ui.girlHidden"):t("ui.girlVisible")))},s.querySelector(".edit").onclick=f=>{f.stopPropagation(),openForm(d)},s.querySelector(".delete").onclick=f=>{f.stopPropagation(),openDelete(d)}),s.addEventListener("mouseenter",()=>{clearTimeout(c),c=setTimeout(()=>{const f=document.getElementById("cardHoverPreview");if(!f)return;const u=s.querySelector(".card-avail,.card-coming,.card-last-seen"),b=u?u.innerHTML:"",w=u?u.classList.contains("card-avail-live")?"chp-avail chp-avail-live":u.classList.contains("card-coming")?"chp-avail chp-avail-coming":u.classList.contains("card-last-seen")?"chp-avail chp-avail-last":"chp-avail":"chp-avail";f.innerHTML=`<div class="chp-name">${e.name||""}</div><div class="chp-country">${Array.isArray(e.country)?e.country.join(", "):e.country||""}</div>${e.special?'<div class="chp-special">'+e.special+"</div>":""}${cardRatingHtml(e)?'<div class="chp-rating">'+cardRatingHtml(e)+"</div>":""}${b?'<div class="'+w+'">'+b+"</div>":""}<div class="chp-stats"><div class="chp-row"><span>${t("field.age")}</span><span>${e.age||"—"}</span></div><div class="chp-row"><span>${t("field.body")}</span><span>${e.body||"—"}</span></div><div class="chp-row"><span>${t("field.height")}</span><span>${e.height?e.height+" cm":"—"}</span></div><div class="chp-row"><span>${t("field.cup")}</span><span>${e.cup||"—"}</span></div><div class="chp-divider"></div><div class="chp-row"><span>${t("field.rates30")}</span><span>${e.val1||"—"}</span></div><div class="chp-row"><span>${t("field.rates45")}</span><span>${e.val2||"—"}</span></div><div class="chp-row"><span>${t("field.rates60")}</span><span>${e.val3||"—"}</span></div><div class="chp-row"><span>${t("field.experience")}</span><span>${e.exp||"—"}</span></div></div>`,f.classList.add("visible")},180)}),s.addEventListener("mouseleave",()=>{clearTimeout(c),document.getElementById("cardHoverPreview")?.classList.remove("visible")}),s.addEventListener("mousemove",f=>{const u=document.getElementById("cardHoverPreview");if(!u||!u.classList.contains("visible"))return;const b=window.innerWidth,w=window.innerHeight,L=u.offsetWidth||220,k=u.offsetHeight||280;let A=f.clientX+16,M=f.clientY+16;A+L>b-8&&(A=f.clientX-L-12),M+k>w-8&&(M=f.clientY-k-12),u.style.left=A+"px",u.style.top=M+"px"}),s});a&&grid.appendChild(a)}),bindCardFavs(grid),bindCardCompare(grid),observeLazy(grid),observeEntrance(grid)})}function hasGirlsOnDate(l){return girls.some(o=>{const c=getCalEntry(o.name,l);return c&&c.start&&c.end})}function renderRosterFilters(){const l=document.getElementById("rosterFilterBar");l.innerHTML="";const o=getWeekDates(),c=o[0];rosterDateFilter||(rosterDateFilter=c);const e=o.filter(r=>hasGirlsOnDate(r));e.length&&!e.includes(rosterDateFilter)&&(rosterDateFilter=e[0]),e.length||(rosterDateFilter=null),e.forEach(r=>{const a=dispDate(r),d=document.createElement("button");d.className="filter-btn"+(r===rosterDateFilter?" date-active":""),d.textContent=r===c?t("ui.today"):a.day+" "+a.date,d.onclick=()=>{rosterDateFilter=r,rosterAvailFilter=null,renderRosterFilters(),renderRosterGrid()},l.appendChild(d)}),renderAvailNowBar()}function renderRosterGrid(){safeRender("Roster Grid",()=>{const l=document.getElementById("rosterGrid");if(l.innerHTML="",!rosterDateFilter){l.innerHTML=`<div class="empty-msg">${t("ui.noGirlsWeek")}</div>`;return}const o=fmtDate(getAEDTDate()),c=rosterDateFilter;let e=[...girls].filter(a=>{const d=getCalEntry(a.name,c);return d&&d.start&&d.end});if(isAdmin()||(e=e.filter(a=>!a.hidden)),e=applySharedFilters(e),loggedIn||(e=e.filter(a=>a.name&&String(a.name).trim().length>0)),c===o&&rosterAvailFilter){const a=getAEDTDate(),d=a.getHours()*60+a.getMinutes();rosterAvailFilter==="now"?e=e.filter(s=>s.name&&isAvailableNow(s.name)):rosterAvailFilter==="later"?e=e.filter(s=>{if(!s.name||isAvailableNow(s.name))return!1;const n=getCalEntry(s.name,o);if(!n||!n.start||!n.end)return!1;const[i,m]=n.start.split(":").map(Number),p=i*60+m,[v,h]=n.end.split(":").map(Number);return v*60+h<=p,d<p}):rosterAvailFilter==="finished"&&(e=e.filter(s=>{const n=getCalEntry(s.name,o);if(!n||!n.start||!n.end)return!1;const[i,m]=n.start.split(":").map(Number),[p,v]=n.end.split(":").map(Number),h=i*60+m,y=p*60+v;return y<=h?!1:d>=y&&!isAvailableNow(s.name)}))}if(applySortOrder(e),!e.length){l.innerHTML=`<div class="empty-msg">${t("ui.noGirlsDate")}</div>`;return}let r;e.forEach((a,d)=>{const s=safeCardRender(a,d,()=>{const n=girls.indexOf(a),i=document.createElement("div");i.className="girl-card";const m=a.photos&&a.photos.length?lazyThumb(a.photos[0],"card-thumb",a.name):'<div class="silhouette"></div>',p=c===o,v=getCalEntry(a.name,c),h=p&&a.name&&isAvailableNow(a.name),y=getAEDTDate(),C=p&&v&&v.start&&v.end&&!h&&(()=>{const T=y.getHours()*60+y.getMinutes(),[g,f]=v.end.split(":").map(Number),[u,b]=v.start.split(":").map(Number);return g*60+f>u*60+b&&T>=g*60+f})(),$=v&&v.start&&v.end?" ("+fmtTime12(v.start)+" - "+fmtTime12(v.end)+")":"",E=h?`<div class="card-avail card-avail-live"><span class="avail-now-dot"></span><span>${t("avail.now")}${$}</span></div>`:C?`<div class="card-avail card-avail-finished">${t("avail.finished")}</div>`:p?`<div class="card-avail">${t("avail.laterToday")}${$}</div>`:`<div class="card-avail" style="color:var(--accent)">${$.trim()}</div>`,S=a.name?cardFavBtn(a.name):"",D=a.name?cardCompareBtn(a.name):"";return i.innerHTML=`<div class="card-img" style="background:linear-gradient(135deg,rgba(180,74,255,0.06),rgba(255,111,0,0.03))">${m}${S}${D}</div><div class="card-info"><div class="card-name">${a.name||""}</div><div class="card-country">${Array.isArray(a.country)?a.country.join(", "):a.country||""}</div>${a.special?'<div class="card-special">'+a.special+"</div>":""}${cardRatingHtml(a)}${E}<div class="card-hover-line"></div></div>`,i.onclick=T=>{T.target.closest(".card-fav")||T.target.closest(".card-compare")||(_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage="rosterPage",showProfile(n))},i.addEventListener("mouseenter",()=>{clearTimeout(r),r=setTimeout(()=>{const T=document.getElementById("cardHoverPreview");if(!T)return;const g=i.querySelector(".card-avail,.card-coming,.card-last-seen"),f=g?g.innerHTML:"",u=g?g.classList.contains("card-avail-live")?"chp-avail chp-avail-live":g.classList.contains("card-coming")?"chp-avail chp-avail-coming":g.classList.contains("card-last-seen")?"chp-avail chp-avail-last":"chp-avail":"chp-avail";T.innerHTML=`<div class="chp-name">${a.name||""}</div><div class="chp-country">${Array.isArray(a.country)?a.country.join(", "):a.country||""}</div>${a.special?'<div class="chp-special">'+a.special+"</div>":""}${cardRatingHtml(a)?'<div class="chp-rating">'+cardRatingHtml(a)+"</div>":""}${f?'<div class="'+u+'">'+f+"</div>":""}<div class="chp-stats"><div class="chp-row"><span>${t("field.age")}</span><span>${a.age||"—"}</span></div><div class="chp-row"><span>${t("field.body")}</span><span>${a.body||"—"}</span></div><div class="chp-row"><span>${t("field.height")}</span><span>${a.height?a.height+" cm":"—"}</span></div><div class="chp-row"><span>${t("field.cup")}</span><span>${a.cup||"—"}</span></div><div class="chp-divider"></div><div class="chp-row"><span>${t("field.rates30")}</span><span>${a.val1||"—"}</span></div><div class="chp-row"><span>${t("field.rates45")}</span><span>${a.val2||"—"}</span></div><div class="chp-row"><span>${t("field.rates60")}</span><span>${a.val3||"—"}</span></div><div class="chp-row"><span>${t("field.experience")}</span><span>${a.exp||"—"}</span></div></div>`,T.classList.add("visible")},180)}),i.addEventListener("mouseleave",()=>{clearTimeout(r),document.getElementById("cardHoverPreview")?.classList.remove("visible")}),i.addEventListener("mousemove",T=>{const g=document.getElementById("cardHoverPreview");if(!g||!g.classList.contains("visible"))return;const f=window.innerWidth,u=window.innerHeight,b=g.offsetWidth||220,w=g.offsetHeight||280;let L=T.clientX+16,k=T.clientY+16;L+b>f-8&&(L=T.clientX-b-12),k+w>u-8&&(k=T.clientY-w-12),g.style.left=L+"px",g.style.top=k+"px"}),i});s&&l.appendChild(s)}),bindCardFavs(l),bindCardCompare(l),observeLazy(l),observeEntrance(l),renderAvailNowBar()})}function renderRoster(){renderRosterFilters(),renderRosterGrid()}function renderFavoritesGrid(){safeRender("Favorites Grid",()=>{const l=document.getElementById("favoritesGrid");l.innerHTML="";const o=getFavorites(),c=fmtDate(getAEDTDate());let e=girls.filter(a=>a.name&&o.includes(a.name));if(isAdmin()||(e=e.filter(a=>!a.hidden)),applySortOrder(e),!e.length){l.innerHTML=`<div class="fav-empty"><div class="fav-empty-icon">&hearts;</div><div class="fav-empty-text">${t("ui.favEmpty")}</div><button class="empty-state-cta" onclick="showPage('listPage');Router.push('/girls')">${t("ui.favBrowse")}</button></div>`;return}let r;e.forEach((a,d)=>{const s=safeCardRender(a,d,()=>{const n=girls.indexOf(a),i=document.createElement("div");i.className="girl-card";const m=a.photos&&a.photos.length?lazyThumb(a.photos[0],"card-thumb",a.name):'<div class="silhouette"></div>',p=getCalEntry(a.name,c),h=a.name&&isAvailableNow(a.name)?`<div class="card-avail card-avail-live"><span class="avail-now-dot"></span><span>${t("avail.now")} (${fmtTime12(p.start)} - ${fmtTime12(p.end)})</span></div>`:p&&p.start&&p.end?`<div class="card-avail">${t("avail.laterToday")} (${fmtTime12(p.start)} - ${fmtTime12(p.end)})</div>`:"",y=cardFavBtn(a.name),C=cardCompareBtn(a.name);return i.innerHTML=`<div class="card-img" style="background:linear-gradient(135deg,rgba(180,74,255,0.06),rgba(255,111,0,0.03))">${m}${y}${C}</div><div class="card-info"><div class="card-name">${a.name||""}</div><div class="card-country">${Array.isArray(a.country)?a.country.join(", "):a.country||""}</div>${a.special?'<div class="card-special">'+a.special+"</div>":""}${cardRatingHtml(a)}${h}<div class="card-hover-line"></div></div>`,i.onclick=$=>{$.target.closest(".card-fav")||$.target.closest(".card-compare")||(_savedScrollY=window.scrollY,sessionStorage.setItem("ginza_scroll",window.scrollY),profileReturnPage="favoritesPage",showProfile(n))},i.addEventListener("mouseenter",()=>{clearTimeout(r),r=setTimeout(()=>{const $=document.getElementById("cardHoverPreview");if(!$)return;const E=i.querySelector(".card-avail,.card-coming,.card-last-seen"),S=E?E.innerHTML:"",D=E?E.classList.contains("card-avail-live")?"chp-avail chp-avail-live":E.classList.contains("card-coming")?"chp-avail chp-avail-coming":E.classList.contains("card-last-seen")?"chp-avail chp-avail-last":"chp-avail":"chp-avail";$.innerHTML=`<div class="chp-name">${a.name||""}</div><div class="chp-country">${Array.isArray(a.country)?a.country.join(", "):a.country||""}</div>${a.special?'<div class="chp-special">'+a.special+"</div>":""}${cardRatingHtml(a)?'<div class="chp-rating">'+cardRatingHtml(a)+"</div>":""}${S?'<div class="'+D+'">'+S+"</div>":""}<div class="chp-stats"><div class="chp-row"><span>${t("field.age")}</span><span>${a.age||"—"}</span></div><div class="chp-row"><span>${t("field.body")}</span><span>${a.body||"—"}</span></div><div class="chp-row"><span>${t("field.height")}</span><span>${a.height?a.height+" cm":"—"}</span></div><div class="chp-row"><span>${t("field.cup")}</span><span>${a.cup||"—"}</span></div><div class="chp-divider"></div><div class="chp-row"><span>${t("field.rates30")}</span><span>${a.val1||"—"}</span></div><div class="chp-row"><span>${t("field.rates45")}</span><span>${a.val2||"—"}</span></div><div class="chp-row"><span>${t("field.rates60")}</span><span>${a.val3||"—"}</span></div><div class="chp-row"><span>${t("field.experience")}</span><span>${a.exp||"—"}</span></div></div>`,$.classList.add("visible")},180)}),i.addEventListener("mouseleave",()=>{clearTimeout(r),document.getElementById("cardHoverPreview")?.classList.remove("visible")}),i.addEventListener("mousemove",$=>{const E=document.getElementById("cardHoverPreview");if(!E||!E.classList.contains("visible"))return;const S=window.innerWidth,D=window.innerHeight,T=E.offsetWidth||220,g=E.offsetHeight||280;let f=$.clientX+16,u=$.clientY+16;f+T>S-8&&(f=$.clientX-T-12),u+g>D-8&&(u=$.clientY-g-12),E.style.left=f+"px",E.style.top=u+"px"}),i});s&&l.appendChild(s)}),l.querySelectorAll(".card-fav").forEach(a=>{a.onclick=d=>{d.stopPropagation();const s=a.dataset.favName;s&&(toggleFavorite(s),updateFavBadge(),renderFavoritesGrid())}}),bindCardCompare(l),observeLazy(l),observeEntrance(l)})}function renderValueTable(){safeRender("Value Table",()=>{const l=document.getElementById("valueTable"),o=[{label:"30 mins",key:"val1"},{label:"45 mins",key:"val2"},{label:"60 mins",key:"val3"}];let c=`<thead><tr><th style="text-align:left">${t("table.rates")}</th><th style="text-align:left">${t("table.priceRange")}</th></tr></thead><tbody>`;o.forEach(e=>{const r=[];girls.forEach(d=>{const s=d[e.key];if(!s)return;String(s).replace(/[\$,\s]/g,"").split(/[-–—~]+/).forEach(m=>{const p=parseFloat(m);!isNaN(p)&&p>0&&r.push(p)})});let a="—";if(r.length){const d=Math.min(...r),s=Math.max(...r);a=d===s?"$"+d:"$"+d+" – $"+s}c+=`<tr><td style="text-align:left;font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:2px;color:#fff;text-transform:uppercase">${e.label}</td><td style="text-align:left;font-family:'Orbitron',sans-serif;font-size:16px;letter-spacing:2px;color:var(--accent)">${a}</td></tr>`}),c+="</tbody>",l.innerHTML=c})}let calMobileDay=0;function updateMobileCalView(l,o){const c=String(calMobileDay+1);l.querySelectorAll("[data-cal-col]").forEach(r=>{r.classList.toggle("cal-col-active",r.dataset.calCol===c)});const e=document.getElementById("calMobileDayLabel");if(e){const r=dispDate(o[calMobileDay]);e.textContent=(calMobileDay===0?"Today · ":"")+r.day+" "+r.date}}function generateTimeOptions(){const l=['<option value="">--:--</option>'];for(let o=0;o<24;o++)for(let c=0;c<60;c+=30){const e=String(o).padStart(2,"0")+":"+String(c).padStart(2,"0"),r=o===0?12:o>12?o-12:o;l.push(`<option value="${e}">${r}:${String(c).padStart(2,"0")} ${o<12?"AM":"PM"}</option>`)}return l.join("")}function renderCalendar(){safeRender("Calendar",()=>{const l=document.getElementById("calFilterBar");if(l.innerHTML="",isAdmin()){const s=document.createElement("button");s.className="add-btn",s.innerHTML="&#x2398; Copy Day",s.onclick=()=>openCopyDayModal(),l.appendChild(s)}const o=applySharedFilters([...girls].filter(s=>s.name&&String(s.name).trim().length>0)).sort((s,n)=>(s.name||"").trim().toLowerCase().localeCompare((n.name||"").trim().toLowerCase())),c=document.getElementById("calTable"),e=getWeekDates(),r=e[0],a=generateTimeOptions();let d=`<thead><tr><th>${t("cal.profile")}</th>`;e.forEach((s,n)=>{const i=dispDate(s);d+=`<th class="${n===0?"cal-today":""}" data-cal-col="${n+1}">${i.date}<span class="cal-day-name">${i.day}${n===0?` (${t("ui.today")})`:""}</span></th>`}),d+="</tr></thead><tbody>",o.forEach(s=>{const n=girls.indexOf(s),i=s.photos&&s.photos.length?lazyCalAvatar(s.photos[0],s.name):`<span class="cal-letter">${s.name.charAt(0)}</span>`,m=isAdmin()?`<div class="cal-bulk-actions"><button class="cal-bulk-btn cal-bulk-all" data-bulk-name="${s.name}" title="Mark available all week">${t("cal.allWeek")}</button><button class="cal-bulk-btn cal-bulk-clear" data-bulk-name="${s.name}" title="Clear entire week">${t("cal.clear")}</button></div>`:"";d+=`<tr><td><div class="cal-profile" data-idx="${n}"><div class="cal-avatar">${i}</div><div><div class="cal-name">${s.name}</div>${m}</div></div></td>`,e.forEach((p,v)=>{const h=getCalEntry(s.name,p),y=h?"checked":"",C=!!h;d+=`<td class="${v===0?"cal-today":""}" data-cal-col="${v+1}"><div class="cal-cell-inner"><input type="checkbox" class="cal-check" data-name="${s.name}" data-date="${p}" ${y}><div class="cal-time-wrap" style="display:${C?"flex":"none"}" data-time-name="${s.name}" data-time-date="${p}"><div class="cal-time-row"><label>Start</label><select class="cal-time-input" data-field="start" data-tname="${s.name}" data-tdate="${p}">${a}</select></div><div class="cal-time-row"><label>End</label><select class="cal-time-input" data-field="end" data-tname="${s.name}" data-tdate="${p}">${a}</select></div><div class="cal-time-warn" data-warn-name="${s.name}" data-warn-date="${p}"></div></div></div></td>`}),d+="</tr>"}),d+="</tbody>",c.innerHTML=d,observeLazy(c),observeCalEntrance(c);{const s=document.getElementById("calMobileNav");if(s){s.innerHTML='<div class="cal-mobile-nav"><button class="cal-mobile-btn" id="calMobilePrev">&#8249;</button><div class="cal-mobile-label" id="calMobileDayLabel"></div><button class="cal-mobile-btn" id="calMobileNext">&#8250;</button></div>';const n=document.getElementById("calMobilePrev"),i=document.getElementById("calMobileNext");n&&(n.onclick=()=>{calMobileDay>0&&(calMobileDay--,updateMobileCalView(c,e))}),i&&(i.onclick=()=>{calMobileDay<6&&(calMobileDay++,updateMobileCalView(c,e))}),updateMobileCalView(c,e)}}o.forEach(s=>{getWeekDates().forEach(n=>{const i=getCalEntry(s.name,n);if(i){const m=c.querySelector(`select[data-field="start"][data-tname="${s.name}"][data-tdate="${n}"]`),p=c.querySelector(`select[data-field="end"][data-tname="${s.name}"][data-tdate="${n}"]`);if(m&&i.start&&(m.value=i.start),p&&i.end&&(p.value=i.end),!i.start||!i.end){calPending[s.name]||(calPending[s.name]={}),calPending[s.name][n]=!0;const v=c.querySelector(`[data-warn-name="${s.name}"][data-warn-date="${n}"]`);v&&(v.textContent="Times required")}}})}),c.querySelectorAll(".cal-profile").forEach(s=>{s.onclick=n=>{n.target.closest(".cal-bulk-btn")||(profileReturnPage="calendarPage",showProfile(parseInt(s.dataset.idx)))}}),isAdmin()&&(c.querySelectorAll(".cal-bulk-all").forEach(s=>{s.onclick=n=>{n.stopPropagation();const i=s.dataset.bulkName;openBulkTimeModal(i)}}),c.querySelectorAll(".cal-bulk-clear").forEach(s=>{s.onclick=n=>{n.stopPropagation();const i=s.dataset.bulkName,m=getWeekDates();let p=0;m.forEach(v=>{calData[i]&&calData[i][v]&&(delete calData[i][v],p++),calPending[i]&&delete calPending[i][v]}),p>0&&(queueCalSave(null,100),renderCalendar(),renderRoster(),renderGrid(),renderHome(),showToast(i+" cleared for the week"))}})),c.querySelectorAll(".cal-check").forEach(s=>{s.onchange=async function(){const n=this.dataset.name,i=this.dataset.date,m=c.querySelector(`[data-time-name="${n}"][data-time-date="${i}"]`);if(this.checked){calData[n]||(calData[n]={});const p=findExistingTimes(n,i);if(p){const v=await showCopyTimePrompt(n,p.date,p.start,p.end);if(v==="cancel"){this.checked=!1,calData[n]&&delete calData[n][i],calPending[n]&&delete calPending[n][i],m&&(m.style.display="none");return}if(v==="copy"){if(calData[n][i]={start:p.start,end:p.end},m){m.style.display="flex";const y=c.querySelector(`select[data-field="start"][data-tname="${n}"][data-tdate="${i}"]`),C=c.querySelector(`select[data-field="end"][data-tname="${n}"][data-tdate="${i}"]`);y&&(y.value=p.start),C&&(C.value=p.end);const $=c.querySelector(`[data-warn-name="${n}"][data-warn-date="${i}"]`);$&&($.textContent="")}const h=this.closest("td");queueCalSave(h,100),showToast("Times copied");return}else{if(calData[n][i]={start:"",end:""},calPending[n]||(calPending[n]={}),calPending[n][i]=!0,m){m.style.display="flex";const h=c.querySelector(`[data-warn-name="${n}"][data-warn-date="${i}"]`);h&&(h.textContent="Times required")}return}}if(calData[n][i]={start:"",end:""},calPending[n]||(calPending[n]={}),calPending[n][i]=!0,m){m.style.display="flex";const v=c.querySelector(`[data-warn-name="${n}"][data-warn-date="${i}"]`);v&&(v.textContent="Times required")}}else{if(calData[n]&&delete calData[n][i],calPending[n]&&delete calPending[n][i],m){m.style.display="none";const p=c.querySelector(`select[data-field="start"][data-tname="${n}"][data-tdate="${i}"]`),v=c.querySelector(`select[data-field="end"][data-tname="${n}"][data-tdate="${ds}"]`);p&&(p.value=""),v&&(v.value="");const h=c.querySelector(`[data-warn-name="${n}"][data-warn-date="${i}"]`);h&&(h.textContent="")}queueCalSave(this.closest("td"))}}}),c.querySelectorAll(".cal-time-input").forEach(s=>{s.onchange=function(){const n=this.dataset.tname,i=this.dataset.tdate,m=this.dataset.field;if(!calData[n]||!calData[n][i])return;typeof calData[n][i]!="object"&&(calData[n][i]={start:"",end:""}),calData[n][i][m]=this.value;const p=calData[n][i],v=c.querySelector(`[data-warn-name="${n}"][data-warn-date="${i}"]`);p.start&&p.end?(this.classList.remove("invalid"),calPending[n]&&delete calPending[n][i],v&&(v.textContent=""),queueCalSave(this.closest("td")),showToast("Schedule saved")):(this.classList.remove("invalid"),v&&(v.textContent="Times required"),calPending[n]||(calPending[n]={}),calPending[n][i]=!0)}})})}
